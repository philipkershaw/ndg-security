<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>NDG Security Installation Guide</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.3  (Linux)">
	<META NAME="AUTHOR" CONTENT="P J Kershaw">
	<META NAME="CREATED" CONTENT="20071010;9350000">
	<META NAME="CHANGED" CONTENT="20080111;11231200">
	<STYLE TYPE="text/css">
	<!--
		@page { margin-left: 2.54cm; margin-right: 2.29cm; margin-top: 1.27cm; margin-bottom: 1.27cm }
		@page:first { margin-top: 1.27cm; margin-bottom: 2.54cm }
		P { margin-bottom: 0.42cm; direction: ltr; color: #000000; text-align: left; widows: 2; orphans: 2 }
		P.western { font-family: "Helvetica", sans-serif; font-size: 10pt }
		P.cjk { font-family: "Times New Roman", "Times", serif; font-size: 10pt }
		P.ctl { font-family: "Times New Roman", "Times", serif; font-size: 10pt; so-language: ar-SA }
		H1 { margin-bottom: 0.42cm; direction: ltr; color: #000000; text-align: justify; widows: 2; orphans: 2; page-break-before: always }
		H1.western { font-family: "Helvetica", sans-serif; font-size: 10pt }
		H1.cjk { font-family: "Times New Roman", "Times", serif; font-size: 10pt }
		H1.ctl { font-family: "Times New Roman", "Times", serif; font-size: 10pt; so-language: ar-SA; font-weight: medium }
		H2 { margin-left: 0.1cm; margin-top: 0cm; margin-bottom: 0.42cm; direction: ltr; color: #000000; text-align: left; widows: 2; orphans: 2 }
		H2.western { font-family: "Helvetica", sans-serif; font-size: 10pt }
		H2.cjk { font-family: "Times New Roman", "Times", serif; font-size: 10pt }
		H2.ctl { font-family: "Times New Roman", "Times", serif; font-size: 10pt; so-language: ar-SA; font-weight: medium }
		H3 { margin-top: 0cm; margin-bottom: 0.42cm; direction: ltr; color: #000000; text-align: justify; widows: 2; orphans: 2 }
		H3.western { font-family: "Helvetica", sans-serif; font-size: 10pt; font-style: italic }
		H3.cjk { font-family: "Times New Roman", "Times", serif; font-size: 10pt; font-style: italic }
		H3.ctl { font-family: "Times New Roman", "Times", serif; font-size: 10pt; so-language: ar-SA; font-weight: medium }
		H4 { margin-top: 0cm; margin-bottom: 0cm; direction: ltr; color: #000000; text-align: justify; widows: 2; orphans: 2 }
		H4.western { font-family: "Helvetica", sans-serif; font-size: 10pt; font-style: italic; font-weight: medium }
		H4.cjk { font-family: "Times New Roman", "Times", serif; font-size: 10pt; font-style: italic; font-weight: medium }
		H4.ctl { font-family: "Times New Roman", "Times", serif; font-size: 10pt; so-language: ar-SA; font-weight: medium }
		A:link { color: #0000ff }
		A:visited { color: #800080 }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-GB" TEXT="#000000" LINK="#0000ff" VLINK="#800080" DIR="LTR">
<DIV TYPE=HEADER>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 1.17cm"><BR><BR>
	</P>
</DIV>
<P ALIGN=LEFT><BR><BR>
</P>
<P ALIGN=LEFT><A NAME="_Ref179772410"></A><BR><BR>
</P>
<P ALIGN=LEFT><SPAN ID="Frame1" DIR="LTR" STYLE="float: left; width: 12.96cm; height: 4.77cm; border: none; padding: 0cm; background: #ffffff">
	<P ALIGN=RIGHT><FONT SIZE=6 STYLE="font-size: 28pt"><B>NERC Data
	Grid Security</B></FONT></P>
	<P ALIGN=RIGHT><FONT SIZE=6><B>Installation Guide</B></FONT></P>
	<P ALIGN=RIGHT><FONT SIZE=3><B>Version 1.0</B></FONT></P>
</SPAN><BR><BR>
</P>
<P ALIGN=LEFT STYLE="page-break-before: always"><FONT SIZE=4 STYLE="font-size: 16pt"><B>Document
Log</B></FONT></P>
<TABLE WIDTH=627 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=194>
	<COL WIDTH=195>
	<COL WIDTH=195>
	<TR VALIGN=TOP>
		<TD WIDTH=194 BGCOLOR="#d9d9d9">
			<P ALIGN=JUSTIFY><B>Version Number</B></P>
		</TD>
		<TD WIDTH=195 BGCOLOR="#d9d9d9">
			<P CLASS="western" ALIGN=JUSTIFY><B>Date</B></P>
		</TD>
		<TD WIDTH=195 BGCOLOR="#d9d9d9">
			<P CLASS="western" ALIGN=JUSTIFY><B>Comment</B></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.1</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>04/11/05</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>First Draft</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.2</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>21/02//06</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Draft for installation at NOCS</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.3</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>07/04/06</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Updates following installation at
			NOCS</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.4</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>25/07/06</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Include deployment model and
			details about SysV style init scripts for web services.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.5</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>16/01/07</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Instructions for installation of
			python packages and associated C library dependencies from source
			and corrections for MyProxy installation.</P>
			<P CLASS="western" ALIGN=JUSTIFY>Installation instructions apply
			to NDG-Security Post Alpha release 0.72.</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.6</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>17/08/07</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Updated for NDG Beta release.  
			</P>
			<UL>
				<LI><P CLASS="western" ALIGN=JUSTIFY>Installation of python
				packages is now via distutils eggs.  
				</P>
				<LI><P CLASS="western" ALIGN=JUSTIFY>Python services use Twisted.</P>
			</UL>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.7</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>03/10/07</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>Tidied headers for creation of
			HTML version</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.8</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>09/10/07</P>
		</TD>
		<TD WIDTH=195>
			<UL>
				<LI><P CLASS="western" ALIGN=LEFT>Updates for mapConfig.xml,
				sessionMgrProperties.xml and attAuthorityProperties.xml config
				files</P>
				<LI><P CLASS="western" ALIGN=LEFT>Configuration for logging</P>
			</UL>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>0.9</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>11//10/07</P>
		</TD>
		<TD WIDTH=195>
			<UL>
				<LI VALUE=1><P CLASS="western" ALIGN=LEFT>Use of MyProxy with a
				SimpleCA and PAM callout for authentication</P>
				<LI><P CLASS="western" ALIGN=LEFT>details for certificate
				requests for Session Manager and Attribute Authority</P>
			</UL>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=194>
			<P ALIGN=JUSTIFY>1.0</P>
		</TD>
		<TD WIDTH=195>
			<P CLASS="western" ALIGN=JUSTIFY>11/01/08</P>
		</TD>
		<TD WIDTH=195>
			<UL>
				<LI VALUE=1><P CLASS="western" ALIGN=LEFT>More notes in
				Appendices about M2Crypto installation</P>
				<LI><P CLASS="western" ALIGN=LEFT>re-ordered MyProxy and Python
				package headings</P>
			</UL>
		</TD>
	</TR>
</TABLE>
<P ALIGN=LEFT STYLE="page-break-before: always"><FONT SIZE=4 STYLE="font-size: 16pt"><B>Contents</B></FONT></P>
<DIV ID="Table of Contents1" DIR="LTR">
	<P ALIGN=JUSTIFY><A HREF="#1. References|outline">1.  References	6</A></P>
	<P ALIGN=JUSTIFY><A HREF="#2. Introduction|outline">2. 
	Introduction	7</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#2.1. Pre-requisites |outline">2.1
	 Pre-requisites 	7</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#2.2. Deployment Model|outline">2.2
	 Deployment Model	7</A></P>
	<P ALIGN=JUSTIFY><A HREF="#3. Software Installation Components|outline">3.
	 Software Installation Components	10</A></P>
	<P ALIGN=JUSTIFY><A HREF="#4.Installation|outline">4.
	Installation	11</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#4.1. Globus MyProxy and SimpleCA|outline">4.1
	 Globus MyProxy and SimpleCA	11</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.1. MyProxy and NDG Security Background|outline">4.1.1
	 MyProxy and NDG Security Background	11</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.2. MyProxy user account and the repository location considerations|outline">4.1.2
	 MyProxy user account and the repository location considerations	11</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.3. Installation|outline">4.1.3
	 Installation	12</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.4. SimpleCA Installation|outline">4.1.4
	 SimpleCA Installation	13</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.5. Host Certificate Creation|outline">4.1.5
	 Host Certificate Creation	16</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.6. MyProxy Configuration File|outline">4.1.6
	 MyProxy Configuration File	17</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.7. MyProxy SimpleCA Configuration|outline">4.1.7
	 MyProxy SimpleCA Configuration	17</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.8. MyProxy PAM Configuration|outline">4.1.8
	 MyProxy PAM Configuration	19</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.9. Testing MyProxy|outline">4.1.9
	 Testing MyProxy	19</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.1.10. Adding MyProxy Server to the system start up|outline">4.1.10
	 Adding MyProxy Server to the system start up	22</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#4.2. NDG Security Python Packages |outline">4.2
	 NDG Security Python Packages 	23</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.1. Dependencies|outline">4.2.1
	 Dependencies	23</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.2. Installation Procedure|outline">4.2.2
	 Installation Procedure	23</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.3. NDG Web Services Configuration|outline">4.2.3
	 NDG Web Services Configuration	24</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.4. Session Manager Configuration|outline">4.2.4
	 Session Manager Configuration	27</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.5. Attribute Authority Configuration|outline">4.2.5
	 Attribute Authority Configuration	32</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#4.2.6. Python Unit Tests|outline">4.2.6
	 Python Unit Tests	36</A></P>
	<P ALIGN=JUSTIFY><A HREF="#5.Appendices|outline">5. Appendices	37</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.1. Postgres PAM for MyProxy|outline">5.1
	 Postgres PAM for MyProxy	37</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.1.1. Configuration|outline">5.1.1
	 Configuration	37</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.2. MySQL Installation|outline">5.2
	 MySQL Installation	38</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.1.Version|outline">5.2.1
	Version	38</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.2. Getting the Binaries|outline">5.2.2
	 Getting the Binaries	38</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.3. New mysql User Account|outline">5.2.3
	 New mysql User Account	38</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.4. Unpacking the tarball|outline">5.2.4
	 Unpacking the tarball	39</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.5. Configuration File|outline">5.2.5
	 Configuration File	39</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.6. Create the Grant Tables|outline">5.2.6
	 Create the Grant Tables	40</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.7. File and Directory Permissions|outline">5.2.7
	 File and Directory Permissions	40</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.8. Starting the Server|outline">5.2.8
	 Starting the Server	40</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.9. Securing MySQL Accounts|outline">5.2.9
	 Securing MySQL Accounts	41</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.2.10. Server Automated Start up|outline">5.2.10
	 Server Automated Start up	42</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.3. HTTPS set-up with Apache Web Server|outline">5.3
	 HTTPS set-up with Apache Web Server	42</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.3.1. Web Server Host Certificate Generation|outline">5.3.1
	 Web Server Host Certificate Generation	42</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.3.2.Apache Configuration File Settings|outline">5.3.2
	Apache Configuration File Settings	42</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.4. Apache Web Server Proxy Settings Configuration for Web Services|outline">5.4
	 Apache Web Server Proxy Settings Configuration for Web Services	42</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.5.An Example Attribute Authority AAUserRoles interface class|outline">5.5
	An Example Attribute Authority AAUserRoles interface class	43</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.35cm"><A HREF="#5.6. Troubleshooting|outline">5.6
	 Troubleshooting	47</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.6.1. M2Crypto |outline">5.6.1
	 M2Crypto 	47</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.6.2. PyXML|outline">5.6.2
	 PyXML	48</A></P>
	<P ALIGN=JUSTIFY STYLE="margin-left: 0.71cm"><A HREF="#5.6.3. 4Suite-XML Build error|outline">5.6.3
	 4Suite-XML Build error	48</A></P>
</DIV>
<H1 CLASS="western"><A NAME="1. References|outline"></A>1. References</H1>
<OL>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT COLOR="#0000ff"><U><A HREF="http://grid.ncsa.uiuc.edu/myproxy/"><SPAN LANG="fi-FI">http://grid.ncsa.uiuc.edu/myproxy/</SPAN></A></U></FONT><SPAN LANG="fi-FI">
	- NCSA MyProxy site</SPAN></P>
	<LI><P LANG="fr-FR" CLASS="western" ALIGN=JUSTIFY><A HREF="http://grid.ncsa.uiuc.edu/myproxy/ca/">http://grid.ncsa.uiuc.edu/myproxy/ca/</A>
	- MyProxy Certificate Authority</P>
	<LI><P LANG="fr-FR" CLASS="western" ALIGN=JUSTIFY><A HREF="http://grid.ncsa.uiuc.edu/myproxy/pam.html">http://grid.ncsa.uiuc.edu/myproxy/pam.html</A>
	– MyProxy PAM Support</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT COLOR="#0000ff"><U><A HREF="http://www-unix.globus.org/toolkit/docs/4.0/security/">http://www-unix.globus.org/toolkit/docs/4.0/security/</A></U></FONT>
	- Globus 4.0 and Security</P>
	<LI><P CLASS="western" ALIGN=LEFT><FONT COLOR="#0000ff"><U><A HREF="http://peak.telecommunity.com/DevCenter/setuptools">http://peak.telecommunity.com/DevCenter/setuptools</A></U></FONT>
	- Python Eggs and Easy Install</P>
	<LI><P CLASS="western" ALIGN=LEFT><FONT COLOR="#0000ff"><U><A HREF="http://pywebsvcs.sourceforge.net/">http://pywebsvcs.sourceforge.net/</A></U></FONT>
	- Python ZSI SOAP Web Services package</P>
	<LI><P CLASS="western" ALIGN=LEFT><FONT COLOR="#0000ff"><U><A HREF="http://chandlerproject.org/bin/view/Projects/MeTooCrypto">http://chandlerproject.org/bin/view/Projects/MeTooCrypto</A></U></FONT>
	- Python M2Crypto OpenSSL wrapper</P>
	<LI><P CLASS="western" ALIGN=LEFT><FONT COLOR="#0000ff"><U><A HREF="http://twistedmatrix.com/trac/">http://twistedmatrix.com/trac/</A></U></FONT>
	- Python Twisted Application Server</P>
	<LI><P CLASS="western" ALIGN=LEFT><A NAME="_Ref132180158"></A>NDG
	Security - Security Measures for Installation [v0.2, 7 September
	2005],
	<FONT COLOR="#0000ff"><U><A HREF="http://bscw.badc.rl.ac.uk/bscw/bscw.cgi/d77103/NDG%20Security%20-%20Security%20Measures%20for%20Installation">http://bscw.badc.rl.ac.uk/bscw/bscw.cgi/d77103/NDG%20Security%20-%20Security%20Measures%20for%20Installation</A></U></FONT></P>
</OL>
<H1 CLASS="western"><A NAME="2. Introduction|outline"></A>2.
Introduction</H1>
<P CLASS="western" ALIGN=JUSTIFY>This is a guide for system
administrators and developers deploying NDG security at a data
centre.</P>
<H2 CLASS="western"><A NAME="2.1. Pre-requisites |outline"></A>2.1
Pre-requisites 
</H2>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>For NDG Security Web Services:
	a host running RedHat Enterprise AS4 or later is recommended.  Other
	Linux distributions may also be suitable.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>For MyProxy: a separate host
	machine (See MyProxy for details of operating systems supported). 
	The host must be secure: if possible a dedicated machine with
	minimal other services running on it.  It should be kept up to date
	with patches and system logs monitored regularly.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>MyProxy and Security web
	services hosts must be configured to link with an NTP server to
	enable clocks to be synchronised with security services running at
	other NDG sites.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Access to a web server if
	security for web based applications is required.  The web server
	must be able to be configured to support HTTPS.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>[MySQL 3.23 or greater or
	Postgres – these are optional and are required for the NDG
	CredentialRepository only]</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Python 2.4 or later</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Python setuptools utility</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>OpenSSL is required at version
	0.9.8 or greater.  Libraries and header files must be present in
	addition to executable(s)</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>SWIG 1.3.24 or later (for
	M2Crypto Python OpenSSL wrapper)</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-left: 0.64cm">Also
note document NDG <I>Security - Security Measures for Installation</I>
 (see Ref 1 above).</P>
<H2 CLASS="western"><A NAME="2.2. Deployment Model|outline"></A>2.2
Deployment Model</H2>
<P CLASS="western" ALIGN=JUSTIFY>The following diagram gives an
example deployment configuration for NDG security services.</P>
<P CLASS="western" ALIGN=JUSTIFY><IMG SRC="NDGSecurityInstallationGuide_html_m1b1d83c.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=611 HEIGHT=614 BORDER=0></P>
<P CLASS="western" ALIGN=JUSTIFY>All services are positioned behind
the firewall.  MyProxy is installed on a dedicated machine in order
to make its repository as secure as possible.  Connections to MyProxy
may be made from the Session Manager web service only from within the
internal network.</P>
<P CLASS="western" ALIGN=JUSTIFY>In the above, security web services
are run together on the same host but this does not have to be the
case.  They can be run on separate servers.  Similarly, the web
server is on a separate host but could be run on the same machine as
the web services if it was felt to be appropriate.</P>
<P CLASS="western" ALIGN=JUSTIFY>In the above diagram Attribute
Authority accesses a user database.  It is assumed that the target
site has a database to store user and user role/access right
information.  This information needn’t be stored by means of a
database and could be represented in some other way.  It is for the
data provider to decide.  Similarly, the Session Manager web service
interfaces with a Credential Repository.   This is a database in the
above but could be some other kind of permanent store.</P>
<P CLASS="western" ALIGN=JUSTIFY>Databases are on a separate server
to the web services host.  Web services access the databases over the
internal network.  Finally, the web services have ports exposed in
some way through the firewall to enable communication with other NDG
security web services at other sites.</P>
<H1 CLASS="western"><A NAME="3. Software Installation Components|outline"></A>
3. Software Installation Components</H1>
<P CLASS="western" ALIGN=JUSTIFY>The NDG Security software can be
divided into the categories of Python packages which implement NDG
Security web services and third party packages Globus MyProxy and
SimpleCA.</P>
<P CLASS="western" ALIGN=JUSTIFY>The Python software is package using
setuptools eggs.   These are divided into separate components to suit
the particular installation required:</P>
<UL>
	<LI VALUE=1><P CLASS="western" ALIGN=LEFT>ndg_security_server –
	components required to run services</P>
	<LI><P CLASS="western" ALIGN=LEFT>ndg_security_common – components
	required by both server and common eggs</P>
	<LI><P CLASS="western" ALIGN=LEFT>ndg_security_client – components
	for building clients to NDG security services.  For example, a data
	provider’s web application server would these to enable the
	securing of access to resources or an organisation’s Identity
	provider would need these to authenticate and allocate authorisation
	attributes to users.</P>
	<LI><P CLASS="western" ALIGN=LEFT>ndg_security_test – unit tests
	for all components</P>
	<LI><P CLASS="western" ALIGN=LEFT>ndg_security – install all:
	client, server and common components</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY>Eggs rely on the distutils
easy_install command to manage installation but NDG security uses an
additional script ndg_security_install.py to install eggs and carry
out the additional installation tasks to correctly configure the
software.</P>
<P CLASS="western" ALIGN=JUSTIFY>The following additional packages
are required:</P>
<UL>
	<LI VALUE=1><P CLASS="western" ALIGN=JUSTIFY>Globus MyProxy 4.0.5
	(or later) – source installer tar ball  may be downloaded from the
	Globus site (<FONT COLOR="#0000ff"><U><A HREF="http://www.globus.org/toolkit/downloads/4.0.1/">http://www.globus.org/toolkit/downloads/4.0.1/</A></U></FONT>)</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Globus SimpleCA to enable the
	MyProxy Certificate Authority.</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY>These two packages should be
installed on the target host for MyProxy.</P>
<H1 CLASS="western"><A NAME="4.Installation|outline"></A>4.Installation</H1>
<P CLASS="western" ALIGN=JUSTIFY>This section is divided into the
MyProxy and Python packages installations.  Note that you will almost
certainly wish to install MyProxy on a separate secure server to the
other Python based security services.</P>
<H2 CLASS="western"><A NAME="4.1. Globus MyProxy and SimpleCA|outline"></A>
4.1 Globus MyProxy and SimpleCA</H2>
<H3 CLASS="western"><A NAME="4.1.1. MyProxy and NDG Security Background|outline"></A>
4.1.1 MyProxy and NDG Security Background</H3>
<P CLASS="western" ALIGN=JUSTIFY>NDG Security makes use of MyProxy
from the Globus toolkit to enable the use of individual user X.509
certificates to secure messages in transactions.  For example, to
request an Attribute Certificate from an Attribute Authority the
request can be signed using the user's certificate to enable the 
Attribute Authority to authenticate it.</P>
<P CLASS="western" ALIGN=JUSTIFY>MyProxy is a flexible and can be
configured to run in a number of different modes or combination of
modes:</P>
<OL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>users can upload a proxy to
	their personal user certificate for storage in the MyProxy
	repository for later use in delegation   
	</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Personal user certificates
	issued by a CA can by stored in the repository.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>MyProxy can be run with the
	Globus SimpleCA package issuing certificates dynamically based on a
	callout to some external authentication system.  MyProxy has basic
	support for PAM (Pluggable Authentication Module) and SASL (<SPAN STYLE="font-style: normal">Simple
	Authentication and Security Layer).</SPAN></P>
</OL>
<P CLASS="western" ALIGN=JUSTIFY>3) is the preferred mode for NDG
deployments as typically NDG partners have existing user databases
against which their users authenticate.   MyProxy can be configured
to query the database with username/password via PAM/SASL.  
</P>
<P CLASS="western" ALIGN=JUSTIFY>MyProxy runs as a service
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>
on its host machine and user credentials are held in a directory on
the file system.  It is important to secure the host to ensure the
credentials are not compromised.   It is recommended to install
MyProxy on a separate host to the other NDG security services as a
security measure.  This host must be carefully secured and run
minimal other services.</P>
<H3 CLASS="western"><A NAME="4.1.2. MyProxy user account and the repository location considerations|outline"></A>
4.1.2 MyProxy user account and the repository location considerations</H3>
<P CLASS="western" ALIGN=JUSTIFY>MyProxy may be installed as root or
using a separate user account.  The latter provides an extra degree
of security but for use with PAM, the MyProxy must be installed and
run as root.  Note that the MyProxy repository will be in a standard
location.  
</P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>If MyProxy is installed as
	root, this is <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/var/myproxy</SPAN></FONT>.
	 
	</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>If installed as under an
	alternative user account, <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/var/myproxy</SPAN></FONT>.
	 
	</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY>When run in mode 3) the repository
is not used since all credentials are generated dynamically on a
successful MyProxy logon request. It is possible to explicitly define
an alternate location but this can only be done by providing a
command line argument to <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>.
 Note that this might be visible in the process list of the host
machine as output from<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">
ps</SPAN></FONT>.  This could be avoided by running <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>
with <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd
</SPAN></FONT>(See 4.1.10.1).</P>
<P CLASS="western" ALIGN=LEFT>This guide assumes installation as
root.  
</P>
<H3 CLASS="western"><A NAME="4.1.3. Installation|outline"></A>4.1.3
Installation</H3>
<P CLASS="western">MyProxy is available with Globus.  Version 4.0.5
distribution is recommended for use with the NDG Security software.  
<FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">C and C++
development packages are needed for the build.</SPAN></FONT></P>
<H4 CLASS="western">4.1.3.1 PAM Dependencies</H4>
<P CLASS="western">A binary version is available but it is
recommended to build and install from the source code to include PAM
dependencies (<A HREF="http://grid.ncsa.uiuc.edu/myproxy/pam.html">http://grid.ncsa.uiuc.edu/myproxy/pam.html</A>).
  To check, there should be a <CODE><FONT FACE="Helvetica, sans-serif">pam_appl.h
header file either in /usr/include/security or /usr/include/pam.</FONT></CODE></P>
<P CLASS="western"><CODE><FONT FACE="Helvetica, sans-serif">If they
are not present, they can be installed with the PAM development
package for your Linux distribution – e.g. pam-devel (Redhat) or
libpam*-dev (Debian based).</FONT></CODE></P>
<P CLASS="western"><CODE><FONT FACE="Helvetica, sans-serif">Due to a
limitation in PAM, MyProxy must be built and installed under the
system root account.</FONT></CODE></P>
<H4 CLASS="western">4.1.3.2<CODE><FONT FACE="Helvetica, sans-serif">
Build</FONT></CODE></H4>
<P CLASS="western"><CODE><FONT FACE="Helvetica, sans-serif">The code
can be downloaded from  </FONT></CODE><FONT COLOR="#0000ff"><U><A HREF="http://www.globus.org/toolkit/downloads/4.0.1/"><FONT FACE="Helvetica, sans-serif">http://www.globus.org/toolkit/downloads/4.0.5</FONT></A></U></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY>Note that it is possible to set a
target for <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">make
</SPAN></FONT>so that only the MyProxy components of Globus are
built.  Click on the link for the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">gt4.0.5-all-source-installer</FONT>
tarball.  Extract the files and change to the
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">gt4.0.5-all-source-installer/</FONT>
directory created.</P>
<P CLASS="western" ALIGN=JUSTIFY>Configure the build settings.  The
default installation location is /usr/local/globus-4.0.5.  Use
–prefix=&lt;dir path&gt; command line option to specify an
alternative location for the installation.</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			./configure </FONT>
			</P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Compile and install MyProxy:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			make gsi-myproxy postinstall</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">When
running</SPAN></FONT> ./configure <FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">you
may see an error if the </SPAN></FONT>JAVA_HOME<FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">
environment variable is not set.  This can be ignored because Java is
not required for the MyProxy build.</SPAN></FONT></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm">  
</P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">If
you encounter errors with the build you can trobuleshoot by checking
config.log in the BUILD/globus_core-* or source-trees/core/source
directories.</SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">Verify
myproxy has built with PAM support by running the command:</SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			/usr/local/globus-4.0.5/sbin/myproxy-server -V</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">myproxy-server
			version MYPROXYv2 (v3.7 12 Dec 2006 PAM)</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT FACE="Helvetica, sans-serif"><SPAN LANG="en-GB">If
'PAM' is included in the output as above then the executable has
built correctly to include PAM support.</SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<H3 CLASS="western"><A NAME="4.1.4. SimpleCA Installation|outline"></A>
4.1.4 SimpleCA Installation</H3>
<P CLASS="western" ALIGN=JUSTIFY>Reference: 
</P>
<P CLASS="western" ALIGN=JUSTIFY><A HREF="http://www-unix.globus.org/toolkit/docs/4.0/security/simpleca/admin-index.html#s-simpleca-admin-installing">http://www-unix.globus.org/toolkit/docs/4.0/security/simpleca/admin-index.html#s-simpleca-admin-installing</A></P>
<P CLASS="western" ALIGN=JUSTIFY>The SimpleCA can be set up under a
dedicated user account but this user must have read/write permissions
to the Globus MyProxy installation location.   For simplicity, this
guide assumes installation for MyProxy and the SimpleCA under root.</P>
<P CLASS="western" ALIGN=JUSTIFY>To install first initialise the
environment settings (These may be added to the appropriate start-up
file e.g. .bashrc):</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="fr-FR"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			export GLOBUS_LOCATION=/usr/local/globus-4.0.5<BR>$ export
			GPT_LOCATION=$GLOBUS_LOCATION<BR>$ .
			$GLOBUS_LOCATION/etc/globus-user-env.sh</FONT></P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Installation
script:</FONT></P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="fr-FR"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			$GLOBUS_LOCATION/setup/globus/setup-simple-ca</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>You will be prompted for the following
information:</P>
<OL>
	<LI><P CLASS="western" ALIGN=LEFT>Subject Name: When prompted, type
	'n' to override the default and set an appropriate subject name for
	the CA for your organisation.  O = Organisation Name, OU =
	Organisational Unit (you can set more than one), CN = the Common
	Name i.e. the name of the Certificate Authority.  For
	example,<BR><BR>/O=STFC/OU=Rutherford Appleton
	Laboratory/OU=Testing/CN=CA<BR><BR>could be the Certificate
	Authority’s subject for a CA for the Space Science and Technology
	Department at Rutherford Appleton Laboratory which is part of the
	Science and Technology Facilities Council.</P>
	<LI><P CLASS="western" ALIGN=LEFT>e-mail Address: the contact
	address for certificate requests.   If you are using the CA for
	MyProxy only you will probably not need this facility.  You could
	enter globus@&lt;target host&gt; or some suitable administrative
	contact</P>
	<LI><P CLASS="western" ALIGN=LEFT>CA Certificate Expiry Date: Press
	enter to accept the default of five years, otherwise override and
	enter your required period.</P>
	<LI><P CLASS="western" ALIGN=LEFT>PEM Pass phrase: this is the
	password that will protect the CA's private key file.  It will need
	to be entered in MyProxy's configuration file to enable MyProxy to
	dynamically issue certificates.</P>
</OL>
<P CLASS="western" ALIGN=LEFT>A message will appear indicating that
the set-up has completed and confirming the subject chosen for your
certificate and the location of certificate and private key:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			$GLOBUS_LOCATION/setup/globus/setup-simple-ca</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">C
			e r t i f i c a t e    A u t h o r i t y    S e t u p</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">This
			script will setup a Certificate Authority for signing Globus</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">users
			certificates.  It will also generate a simple CA package</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">that
			can be distributed to the users of the CA.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			CA information about the certificates it distributes will</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">be
			kept in:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/root/.globus/simpleCA/</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			unique subject name for this CA is:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">cn=Globus
			Simple CA, ou=simpleCA-gabriel, ou=GlobusTest, o=Grid</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Do
			you want to keep this as the CA subject (y/n) [y]:n</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Enter
			a unique subject name for this CA:cn=CA, ou=BADC, ou=Gabriel,
			o=NDG</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Enter
			the email of the CA (this is the email where certificate</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">requests
			will be sent to be signed by the CA):p.j.kershaw@rl.ac.uk</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			CA certificate has an expiration date. Keep in mind that</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">once
			the CA certificate has expired, all the certificates</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">signed
			by that CA become invalid.  A CA should regenerate</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">the
			CA certificate and start re-issuing ca-setup packages</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">before
			the actual CA certificate expires.  This can be done</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">by
			re-running this setup script.  Enter the number of DAYS</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">the
			CA certificate should last before it expires.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">[default:
			5 years (1825 days)]:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Enter
			PEM pass phrase:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Verifying
			- Enter PEM pass phrase:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">creating
			CA config package...done.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">A
			self-signed certificate has been generated</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">for
			the Certificate Authority with the subject:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/O=NDG/OU=Gabriel/OU=BADC/CN=CA</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">If
			this is invalid, rerun this script</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/usr/local/gt4.0.5/setup/globus/setup-simple-ca</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">and
			enter the appropriate fields.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">-------------------------------------------------------------------</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			private key of the CA is stored in
			/root/.globus/simpleCA//private/cakey.pem</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			public CA certificate is stored in
			/root/.globus/simpleCA//cacert.pem</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			distribution package built for this CA is stored in</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/root/.globus/simpleCA//globus_simple_ca_2cba3376_setup-0.19.tar.gz</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">This
			file must be distributed to any host wishing to request</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">certificates
			from this CA.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">CA
			setup complete.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			following commands will now be run to setup the security</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">configuration
			files for this CA:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$GLOBUS_LOCATION/sbin/gpt-build
			/root/.globus/simpleCA//globus_simple_ca_2cba3376_setup-0.19.tar.gz</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$GLOBUS_LOCATION/sbin/gpt-postinstall</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">-------------------------------------------------------------------</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">setup-ssl-utils:
			Configuring ssl-utils package</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Running
			setup-ssl-utils-sh-scripts...</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">***************************************************************************</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Note:
			To complete setup of the GSI software you need to run the</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">following
			script as root to configure your security configuration</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">directory:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/usr/local/gt4.0.5/setup/globus_simple_ca_2cba3376_setup/setup-gsi</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">For
			further information on using the setup-gsi script, use the -help</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">option.
			 The -default option sets this security configuration to be</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">the
			default, and -nonroot can be used on systems where root access is</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">not
			available.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">***************************************************************************</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">setup-ssl-utils:
			Complete</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>The number in the file names “
2cba3376” is a unique h<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ash</SPAN></FONT>
identifier for the CA.  It will be different for for your
installation when you run the setup.  To complete the set-up run the
setup-gsi script:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			$GLOBUS_LOCATION/setup/globus_simple_ca_2cba3376_setup/setup-gsi </FONT>
			</P>
			<P>–<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">default
			</FONT>
			</P>
		</TD>
	</TR>
</TABLE>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<H3 CLASS="western"><A NAME="4.1.5. Host Certificate Creation|outline"></A>
4.1.5 Host Certificate Creation</H3>
<P CLASS="western">As root user to carry out these steps.   First
check the path to the command <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">grid-cert-request</SPAN></FONT>:</P>
<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=609 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=593>
	<TR>
		<TD WIDTH=593 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			which grid-cert-request</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>Should return something like:
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/usr/local/globus-4.0.5/bin/grid-cert-request</FONT></P>
<P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">If
not check the settings as made earlier for the SimpleCA:</FONT></P>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="fr-FR"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			export GLOBUS_LOCATION=/usr/local/globus-4.0.5<BR>$ export
			GPT_LOCATION=$GLOBUS_LOCATION<BR>$ .
			$GLOBUS_LOCATION/etc/globus-user-env.sh</FONT></P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>To generate a host certificate
request:</P>
<TABLE WIDTH=608 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=592>
	<TR>
		<TD WIDTH=592 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			grid-cert-request –host &lt;fully qualified hostname&gt; </FONT>
			</P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>This creates the files <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">hostcert.pem</FONT>,
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">hostkey.pem</FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">hostcert_request.pem
in /etc/grid-security directory</FONT>.  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">hostcert.pem</FONT>
is empty.  
</P>
<P CLASS="western" ALIGN=JUSTIFY>In order to obtain the certificate
it must be signed by the CA:  
</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=42 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="fr-FR"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			grid-ca-sign -in  /<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">etc/grid-security/hostcert_request.pem
			 -out  /etc/grid-security/hostcert.pem </FONT></FONT>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">hostcert_request.pem
</FONT>is no longer needed and can be deleted.</P>
<H3 CLASS="western"><A NAME="4.1.6. MyProxy Configuration File|outline"></A>
4.1.6 MyProxy Configuration File</H3>
<P CLASS="western" ALIGN=JUSTIFY>A MyProxy configuration file is
normally kept in the Globus installation under the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">etc</SPAN></FONT>
directory.   If this file is not already present, copy the sample
file:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			cp $GLOBUS_LOCATION/share/myproxy/myproxy-server.config
			$GLOBUS_LOCATION/etc</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm">Edit
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$GLOBUS_LOCATION/etc/myproxy-server.config
 m</FONT>odifying the entries under the section <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Complete
Sample Policy</SPAN></FONT> so that they are all uncommented (remove
leading <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">#
</SPAN></FONT>character):</P>
<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			Complete Sample Policy</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			The following lines define a sample policy that enables all</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			myproxy-server features.  See below for more examples.</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">accepted_credentials
			       &quot;*&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">authorized_retrievers
			       &quot;*&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">default_retrievers
			             &quot;*&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">authorized_renewers
			        &quot;*&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">default_renewers
			              &quot;none&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">authorized_key_retrievers
			&quot;*&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">default_key_retrievers
			      &quot;none&quot;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">trusted_retrievers
			             “*”</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">default_trusted_retrievers
			“none”</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>Note that the wildcards for these
fields may be modified such that only Distinguished Names of a given
format are accepted e.g. <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">&quot;/O=NDG/OU=BADC/*&quot;</SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY>The <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">chmod
</SPAN></FONT>command ensures that only the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">globus</SPAN></FONT>
user has read/write access for the directory.  Note also that the
directory need not be called <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy</SPAN></FONT>.</P>
<H3 CLASS="western"><A NAME="4.1.7. MyProxy SimpleCA Configuration|outline"></A>
4.1.7 MyProxy SimpleCA Configuration</H3>
<P CLASS="western" ALIGN=LEFT>NDG Security uses MyProxy to
dynamically generate user certificates on user login.  For this,
MyProxy requires configuration details from the SimpleCA.  Make these
settings in $GLOBUS_LOCATION/etc/myproxy-server.config (Note that the
sensitivity of this information and the need to secure this file
carefully!)</P>
<OL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>enable any retriever –
	retrieval is based on the retrievers login credentials:</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">authorized_retrievers
				&quot;*&quot;</FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=JUSTIFY></P>
	<LI><P CLASS="western" ALIGN=LEFT>Set the path to the CA
	certificate.  In this example the CA is installed in the root user's
	home directory:</P>
</OL>
<DL>
	<DD>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">certificate_issuer_cert
				/root/.globus/simpleCA/cacert.pem</FONT></P>
			</TD>
		</TR>
	</TABLE>
</DL>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<OL START=3>
	<LI><P CLASS="western" ALIGN=LEFT>Set the path to the CA private
	key: 
	</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">certificate_issuer_key
				/root/.globus/simpleCA/private/cakey.pem</FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=JUSTIFY></P>
	<LI><P CLASS="western" ALIGN=LEFT>Provide the password to the CA's
	private key.  (This was set when you created the SimpleCA with
	$GLOBUS_LOCATION/setup/globus/setup-simple-ca):</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">certificate_issuer_key_passphrase
				&quot;password&quot;</FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=JUSTIFY></P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Set the path to the certificate
	serial file</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>certificate_serialfile
				/root/.globus/simpleCA/serial </FONT>
				</P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=JUSTIFY></P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Configure how MyProxy maps
	usernames to Distinguished Names in generated certificates. This can
	be done either with a grid mapfile or a script.  A script is more
	flexible as you can use a wildcard match rather requiring a map
	entry for every single user.  An example script is:</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#!/bin/sh<BR>username=$1<BR>if
				[ X&quot;$username&quot; = X ]; then<BR>    # no username given<BR>
				   exit 1<BR>fi<BR>echo
				&quot;/O=NDG/OU=Gabriel/OU=BADC/CN=${username}&quot;</FONT></P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">exit
				0</FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=LEFT><BR>In the example above, if a user
	logs in as pjkershaw, they will be issued with a certificate with
	the Distinguished Name /O=NDG/OU=Gabriel/OU=BADC/CN=pjkershaw. Copy
	the file above file into $GLOBUS_LOCATION/sbin/mapper.sh replacing
	“/O=NDG/OU=Gabriel/OU=BADC/CN=” with the form of the
	Distinguished Name that you require for users for your site.  Ensure
	that the file has execute permissions set e.g.<BR><BR><BR>
	</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
				chmod 700 $GLOBUS_LOCATION/sbin/mapper.sh</FONT></P>
				<P CLASS="western" ALIGN=LEFT><BR>
				</P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=LEFT><BR>Refer to the script in
	$GLOBUS_LOCATION/etc/myproxy-server.config with this setting:</P>
	<TABLE WIDTH=593 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=577>
		<TR>
			<TD WIDTH=577 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>certificate_mapapp
				/usr/local/globus-4.0.5/sbin/mapper.sh</FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P CLASS="western" ALIGN=LEFT></P>
</OL>
<H3 CLASS="western"><A NAME="4.1.8. MyProxy PAM Configuration|outline"></A>
4.1.8 MyProxy PAM Configuration</H3>
<P CLASS="western" ALIGN=JUSTIFY>Reference:
<A HREF="http://grid.ncsa.uiuc.edu/myproxy/pam.html">http://grid.ncsa.uiuc.edu/myproxy/pam.html</A></P>
<P CLASS="western" ALIGN=JUSTIFY>NDG Security makes use of MyProxy
with PAM to enable MyProxy logon requests to be authenticated against
a site's existing security infrastructure, for example a user
database or LDAP repository.   Linux systems have PAMs for login, ssh
and other services.   PAMs can be obtained for the major database
varieties such as MySQL, Postgres and Oracle.</P>
<P CLASS="western">To configure MyProxy for PAM, settings are made
via myproxy-server.config to two different fields:</P>
<UL>
	<LI><P CLASS="western">pam: may be set to disabled, “required”
	or “sufficient”.   Set to “required”.  With this setting,
	all MyProxy logon requests will be authenticated via PAM.   The
	“sufficient” setting may be useful in some circumstances.  It
	enables authentication via PAM and via credentials held in the
	MyProxy repository.</P>
	<LI><P CLASS="western">pam_id: name that MyProxy uses to identify
	itself to PAM.   This can correspond either to a file of the same
	name in /etc/pam.d or entries prefixed with that name in
	/etc/pam.conf.  This setting determines the PAM used by MyProxy to
	authenticate.  
	</P>
</UL>
<P CLASS="western">The most straightforward way to set-up MyProxy
with PAM is to try one of the existing PAMs such as login.  If the
pam_id is set to login, a myproxy-logon request will link to that
user's Linux login.</P>
<P CLASS="western">Appendices are provided at the end of this
document for some of the more common configurations.</P>
<H3 CLASS="western"><A NAME="4.1.9. Testing MyProxy|outline"></A>4.1.9
Testing MyProxy</H3>
<P CLASS="western" ALIGN=JUSTIFY>A simple way to test the MyProxy
configuration to run the myproxy-logon client command.  For initial
testing set the pam_id in $GLOBUS_LOCATION/etc/myproxy-server.config
to “logon” so that it uses the Linux user accounts for
authentication.</P>
<P CLASS="western" ALIGN=JUSTIFY>Client error messages can be
difficult to interpret but a -v verbose option is provided to give
more information.   In addition, MyProxy server can be run in debug
mode using the -d command line switch.   MyProxy should be run under
the user account in which it was installed - root.   Ensure that the
environment is set correctly i.e. GLOBUS_LOCATION variable set and
$GLOBUS_LOCATION/etc/globus-user-env.sh has been sourced<FONT SIZE=2><SPAN LANG="pt-PT">:</SPAN></FONT></P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="fr-FR"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			export GLOBUS_LOCATION=/usr/local/globus-4.0.5<BR>$ export
			GPT_LOCATION=$GLOBUS_LOCATION<BR>$ .
			$GLOBUS_LOCATION/etc/globus-user-env.sh</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>If you already have MyProxy running
via xinetd or as a process started from a SysV init script, it is
possible to run a separate MyProxy server process on a different port
with the -p flag.</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server
			-d -v -p 60000</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server
			v3.7 12 Dec 2006 PAM starting at Fri Dec 21 12:45:59 2007</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">reading
			configuration file
			/usr/local/globus-4.0.5/etc/myproxy-server.config</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">CA
			enabled</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">using
			storage directory /var/myproxy</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Starting
			myproxy-server on localhost: 60000...</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>Note that in debug mode, myproxy-server
will exit after the first request made to it.</P>
<P CLASS="western" ALIGN=LEFT>Run myproxy-logon in a separate window
under a user account for which you know the Linux password.  Provide
the port number if myproxy-server was started on a different port to
the default and give the full name of the server as set in the host
certificate (/etc/grid-security/hostcert.pem)</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-logon
			-v -s &lt;fully qualified server hostname&gt; -p 60000</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">MyProxy
			v3.7 12 Dec 2006 PAM</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Attempting
			to connect to 127.0.0.1:60000</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Enter
			MyProxy pass phrase:</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">using
			trusted certificates directory /etc/grid-security/certificates</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">no
			valid credentials found -- performing anonymous authentication</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">server
			name: /O=NDG/OU=Gabriel/OU=BADC/CN=gabriel&lt;&gt;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">checking
			that server name is acceptable...</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">server
			name does not match &quot;myproxy@gabriel&lt;&gt;&quot;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">server
			name matches &quot;host@gabriel&lt;&gt;&quot;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">authenticated
			server name is acceptable</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">A
			credential has been received for user pjkershaw in
			/tmp/x509up_u1000.</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>The equivalent output from the server
will be something like:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Connection
			from 127.0.0.1</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">using
			trusted certificates directory /etc/grid-security/certificates</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Authenticated
			client &lt;anonymous&gt;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">applying
			trusted_retrievers policy</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">applying
			authorized_retrievers policy</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">applying
			authorized_renewers policy</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">user_dn_lookup()</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">resolve_via_mapapp(/usr/local/globus-4.0.5/sbin/mapper.sh,
			pjkershaw)</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Checking
			passphrase via PAM.  PAM policy: &quot;sufficient&quot;; PAM ID:
			&quot;logon&quot;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">PAM
			authentication succeeded for pjkershaw</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Received
			GET request from &lt;anonymous&gt;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Sending
			OK response to client &lt;anonymous&gt;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">using
			CA callout</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Calling
			CA Extensions</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">handle_certificate()</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Cert
			request loaded.</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Got
			a cert request for user &quot;pjkershaw&quot;, with pubkey hash
			&quot;282944311&quot;, and lifetime &quot;43200&quot;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Using
			internal openssl/generate_certificate() code</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Generating
			certificate internally.</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">user_dn_lookup()</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">using
			cached value</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">tokenizing:
			/O=NDG/OU=BADC/OU=Gabriel/CN=pjkershaw</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">adding:
			O = NDG</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">adding:
			OU = BADC</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">adding:
			OU = Gabriel</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">adding:
			CN = pjkershaw</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Assigning
			serial number</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Loaded
			serial number F6 from /root/.globus/simpleCA/serial</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">serial
			number assigned</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">cert
			lifetime: 43200</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">CAkey:
			/root/.globus/simpleCA/private/cakey.pem</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Signing
			internally generated certificate.</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Issued
			certificate for user &quot;pjkershaw&quot;, with DN
			&quot;/O=NDG/OU=BADC/OU=Gabriel/CN=pjkershaw&quot;, lifetime
			&quot;43200&quot;, and serial number &quot;246&quot;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Sending
			OK response to client &lt;anonymous&gt;</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Client
			&lt;anonymous&gt; disconnected</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>The certificate and private key are
written to file in /tmp by myproxy-logon.   This takes the form
x509up_&lt;uid&gt;.   It's possible to check the certificate
generated using openssl e.g.:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$
			openssl -in /tmp/x509up_1001 -text</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR>The output includes details
including the certificate's DN, issuer and expiry time.   If you wish
to run the test again delete or move this file as myproxy-logon will
try to use it to authenticate to the MyProxy server.</P>
<P CLASS="western" ALIGN=LEFT>If you encounter problems check the
output from the client and server. commands.  The system logs may
contain useful additional information from the PAM used.</P>
<P CLASS="western" ALIGN=LEFT>The Python MyProxy client unit tests
can be used to test the server from a separate client machine where
Python NDG services are installed but not MyProxy itself.   The
MyProxy unit tests are in the package ndg.security.test.myProxy.</P>
<H3 CLASS="western"><A NAME="4.1.10. Adding MyProxy Server to the system start up|outline"></A>
4.1.10 Adding MyProxy Server to the system start up</H3>
<P CLASS="western" ALIGN=JUSTIFY>Any of the standard mechanisms may
be used such as adding a SysV style init script or using <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">inetd</SPAN></FONT>
or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>.
 <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">inetd</SPAN></FONT>/<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>
are preferred:</P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>
	process will not show on <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ps</SPAN></FONT>
	command listing 
	</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm">It’s
	more efficient since it’s only invoked when a request from a
	MyProxy client is received.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm">It’s
	easy to configure so that <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>
	runs as an alternative user to <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">root</SPAN></FONT>.</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-left: 0.63cm; margin-bottom: 0cm">
<BR>
</P>
<H4 CLASS="western"><A NAME="_Ref143089522"></A>4.1.10.1 inetd /
xinetd</H4>
<P CLASS="western" ALIGN=LEFT>To run the myproxy server using <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">inetd
</SPAN></FONT>or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>,
as root user: 
</P>
<UL>
	<LI><P CLASS="western" ALIGN=LEFT>Add the entries in
	<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/share/myproxy/etc.services.modifications</SPAN></FONT>
	to the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/services</SPAN></FONT>
	or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/inet/services</SPAN></FONT>
	file: 
	</P>
</UL>
<DL>
	<DD>
	<TABLE WIDTH=574 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=558>
		<TR>
			<TD WIDTH=558 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">myproxy-server
				 7512/tcp                        # MyProxy server</FONT></P>
				<P><BR>
				</P>
			</TD>
		</TR>
	</TABLE>
</DL>
<P CLASS="western" ALIGN=LEFT STYLE="margin-left: 0.64cm"><BR><BR>
</P>
<UL>
	<LI VALUE=1><P CLASS="western" ALIGN=LEFT>Add the entries from
	<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/share/myproxy/etc.inetd.conf.modifications</SPAN></FONT></P>
	<UL>
		<LI><P CLASS="western" ALIGN=LEFT>For inetd add to <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/inetd.conf
		</SPAN></FONT>or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/inet/inetd.conf</SPAN></FONT>,
		or …</P>
		<LI><P CLASS="western" ALIGN=LEFT>for <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>,
		copy <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/share/myproxy/etc.xinetd.myproxy</SPAN></FONT>
		to <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/xinetd.d/myproxy</SPAN></FONT>.
		Modify the paths in the file according to your installation and set
		the user to the correct user name for running <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">myproxy-server</SPAN></FONT>
		e.g.</P>
	</UL>
</UL>
<DL>
	<DD>
	<TABLE WIDTH=574 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
		<COL WIDTH=558>
		<TR>
			<TD WIDTH=558 VALIGN=TOP BGCOLOR="#e0e0e0">
				<P STYLE="margin-bottom: 0cm"><BR>
				</P>
				<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">service
				myproxy-server</FONT></FONT></P>
				<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">{</FONT></FONT></P>
				<P STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">socket_type
				 = stream</FONT></FONT></P>
				<P STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="pt-PT">protocol
				    = tcp</SPAN></FONT></FONT></P>
				<P LANG="pt-PT" STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">wait
				        = no</FONT></FONT></P>
				<P LANG="pt-PT" STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">user
				        = globus</FONT></FONT></P>
				<P LANG="pt-PT" STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">server
				      = /usr/local/NDG/globus-4.0.1/sbin/myproxy-server</FONT></FONT></P>
				<P LANG="pt-PT" STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">env	
				        = GLOBUS_LOCATION=/usr/local/globus-4.0.5
				LD_LIBRARY_PATH=/usr/local/globus-4.0.5/lib</FONT></FONT></P>
				<P STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">disable
				     = no</FONT></FONT></P>
				<P STYLE="margin-bottom: 0cm">  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">only_from
				   = localhost.localdomain &lt;hostAddress1&gt; &lt;hostAddress2&gt;</FONT></FONT></P>
				<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">}</FONT></FONT></P>
			</TD>
		</TR>
	</TABLE>
</DL>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<UL>
	<LI VALUE=1><P CLASS="western" ALIGN=LEFT>Note also, the additional
	setting in this example for <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">only_from</SPAN></FONT>.
	 This a limit to be placed on which hosts clients can connect from
	to the server.  In the above, clients can connect from the local
	machine (note the fully qualified name including <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">localdomain</SPAN></FONT>)
	and from the hosts <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">&lt;hostAddress1&gt;
	</SPAN></FONT>and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">&lt;hostAddress2&gt;</SPAN></FONT>.
	  Care must be taken with these settings.  Client requests will exit
	with an SSL error if set incorrectly.</P>
	<LI><P CLASS="western" ALIGN=LEFT>Reactivate the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">inetd</SPAN></FONT>
	/ <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>.
	This is typically accomplished by sending the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">SIGHUP</SPAN></FONT>
	signal to the server process.  Redhat Linux machines include the GUI
	tool <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">redhat-config-services</SPAN></FONT>
	to allow convenient management of services.  Refer to the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">inetd</SPAN></FONT>
	or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">xinetd</SPAN></FONT>
	man page for your system.</P>
</UL>
<H4 CLASS="western">4.1.10.2 SysV-style boot script 
</H4>
<P CLASS="western" ALIGN=LEFT>A sample SysV-style boot script for is
available in the Globus installation at,
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/share/myproxy/etc.init.d.myproxy</SPAN></FONT>.
</P>
<P CLASS="western" ALIGN=LEFT>To install: 
</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			cp <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$GLOBUS_LOCATION/share/myproxy/etc.init.d.myproxy
			/etc/rc.d/init.d/myproxy</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$
			chkconfig --add myproxy</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>Edit the file to set the
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">GLOBUS_LOCATION
</SPAN></FONT>environment variable correctly.  
</P>
<H2 CLASS="western"><A NAME="4.2. NDG Security Python Packages |outline"></A>
4.2 NDG Security Python Packages 
</H2>
<H3 CLASS="western"><A NAME="4.2.1. Dependencies|outline"></A>4.2.1
Dependencies</H3>
<H4 CLASS="western">4.2.1.1 OpenSSL</H4>
<P CLASS="western" ALIGN=JUSTIFY>Before proceeding with the
installation check that an up to date version of OpenSSL is
installed:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="da-DK" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="da-DK"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl version</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>0.9.8 or greater is required. 
Should you need to upgrade, OpenSSL is available from
<A HREF="http://www.openssl.org/source/">http://www.openssl.org/source/</A>.
 Once downloaded, unpack the tarball and follow the installation
intstructions.</P>
<H4 CLASS="western">4.2.1.2 SWIG</H4>
<P CLASS="western">SWIG is a tool to help with bindings from C/C++ to
interpreted languages such as Python.  The Python OpenSSL wrapper
M2Crypto uses it and version 1.3.24 or later is required.  Downloads
are available from, <A HREF="http://www.swig.org/">http://www.swig.org</A>.</P>
<H3 CLASS="western"><A NAME="4.2.2. Installation Procedure|outline"></A>
4.2.2 Installation Procedure</H3>
<P CLASS="western" ALIGN=JUSTIFY>Log in to the target host as <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">root</SPAN></FONT>.
 Change to a suitable directory to hold temporary installation files.
 
</P>
<H4 CLASS="western">4.2.2.1 setuptools</H4>
<P CLASS="western" ALIGN=JUSTIFY>The first step is to install Python
setuptools, the package that enables the use of Python eggs. 
Download the setuptools bootstrap script:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="da-DK" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="da-DK"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			wget http://peak.telecommunity.com/dist/ez_setup.py</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>You may need to set the environment
for a http proxy at your site.  For example,</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			export http_proxy=http://yourproxyurl.com:8080</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Run the bootstrap script.  Make sure
to use the correct version of python in your system path.  Some
systems may have multiple python versions installed:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			python ez_setup.py</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western"><BR><BR>
</P>
<P CLASS="western">Once completed, you can delete <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ez_setup.py</SPAN></FONT>.</P>
<H4 CLASS="western">4.2.2.2 Set-up Script</H4>
<P CLASS="western" ALIGN=JUSTIFY>NDG security uses a wrapper to
setuptools <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">easy_install</SPAN></FONT>
to enable custom installation steps to be correctly carried out. 
Download the script from the NDG distribution site:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P LANG="da-DK" STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="da-DK"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			wget http://ndg.nerc.ac.uk/dist/ndg-security-install.py</FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="da-DK" CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Now carry out the installation of
the NDG security python packages:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			python ./ndg-security-install.py -a</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The script options can be checked
using the –h option.  –a selects all packages for installation.  
If there are problems with the installation, see the Troubleshooting
Guide in the Appendices section 5.6.</P>
<H3 CLASS="western"><A NAME="4.2.3. NDG Web Services Configuration|outline"></A>
4.2.3 NDG Web Services Configuration</H3>
<H4 CLASS="western">4.2.3.1 NDG Security System Configuration Files</H4>
<P CLASS="western" ALIGN=JUSTIFY>Properties files set the
configuration settings for NDG security <I>server side</I> settings. 
Templates for these are contained within the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg_security_server</SPAN></FONT>
installed in your python distribution’s site-packages directory.  
A future version of the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg-security-install.py</SPAN></FONT>
script will extract these and install at a suitable location on the
file system.  For the moment though, this is a manual process.</P>
<P CLASS="western" ALIGN=JUSTIFY>Create a configuration area under
your servers <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc</SPAN></FONT>
directory:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="da-DK"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			mkdir /etc/ndg<BR>$ mkdir /etc/ndg/security</FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="da-DK" CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/ndg/security</SPAN></FONT>
is recognised by the Python security software by the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">NDGSEC_DIR
</SPAN></FONT>environment variable.  This variable can be set in the
environment of the user account used to run the security services or
can be set in the init scripts used to automatically start up the
services from server boot up (See sections 4.2.4.2, 4.2.4.3 and 4.2.5.5).</P>
<P CLASS="western" ALIGN=JUSTIFY>Locate the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg_security_server</SPAN></FONT>
egg and copy its <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">conf/</SPAN></FONT>
directory into the configuration area.  For example if you are using
python installed in <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/usr/local</SPAN></FONT>
then the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">conf/</SPAN></FONT>
directory will be in:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">/usr/local/lib/python&lt;python
			version num&gt;/site-packages/ndg_security_server-&lt;version
			info&gt;.egg/ndg/security/server/conf</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Copy as follows:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$ cp
			/usr/local/lib/python&lt;python version
			num&gt;/site-packages/ndg_security_server-&lt;version
			info&gt;.egg/ndg/security/server/conf /etc/ndg/security</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">conf/</SPAN></FONT>
directory will contain these important files:</P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Session Manager and Attribute
	Authority properties XML files</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">openssl.conf</SPAN></FONT>
	– used by the Session Manager to configure client connections to
	MyProxy</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Special <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.tac</SPAN></FONT>
	configuration files loaded by the <I>Twisted</I> application server
	used to run Session Manager and Attribute Authority services</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">certs/</SPAN></FONT>
	directory for storing X.509 certificates</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mapConfig.xml</SPAN></FONT>
	for role mapping and other trust configuration parameters to enable
	the Attribute Authority to operate with other trusted organisations
	within NDG</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attCertLog/</SPAN></FONT>
	directory for storing Attribute Certificates issued by the Attribute
	Authority.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Logging configuration files:
	<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">sessionMgrLog.cfg
	</SPAN></FONT>and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attAuthorityLog.cfg</SPAN></FONT></P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY>The default location for log files
set in <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">sessionMgrLog.cfg</SPAN></FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attAuthorityLog.cfg</SPAN></FONT>
is <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/log</SPAN></FONT>.
 Create this directory as follows:</P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="es-ES"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			mkdir /etc/ndg/security/log</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Note that it is possible to run
security web services under any specified system account and group. 
Ensure that this user has full access to <FONT FACE="Lucida Console"><SPAN LANG="es-ES">/etc/ndg/security</SPAN></FONT><SPAN LANG="es-ES">
e.g.</SPAN></P>
<TABLE WIDTH=612 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=596>
	<TR>
		<TD WIDTH=596 HEIGHT=46 VALIGN=TOP BGCOLOR="#e6e6e6">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="es-ES"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			chmod ndg:ndggroup -R /etc/ndg/security</FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="es-ES" CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H4 CLASS="western">4.2.3.2 Certificate Generation</H4>
<P CLASS="western" ALIGN=JUSTIFY>The Session Manager and Attribute
Authority web services require individual X.509 certificates as a
means to identify them in the various interactions required for user
registration, authentication and authorisation.  These may be created
by similar means to the host certificate creation.</P>
<P CLASS="western" ALIGN=JUSTIFY>Change directory to
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf/certs</SPAN></FONT>.
 The certificates will be stored here.  Make a new private key and
certificate request for the Session Manager:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl genrsa –out sm-key.pem 2048</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			chmod 400 sm-key.pem</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl req –new –key sm-key.pem –out sm.csr</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The private key may be password
protected if required by adding the –des3 option to the genrsa
command.   Type in a password when prompted.   The req command will
prompt you for the components of the Distinguished Name for the new
certificate.  When prompted for the Common Name, enter
‘SessionManager’.  The other fields can be set as required but by
convention for NDG, the Organisation field has been set to NDG and
the Organisation Unit to the individual data provider name e.g. BADC.
 All other fields have been omitted.  You can skip individual fields
by enter ‘.’ When prompted.</P>
<P CLASS="western" ALIGN=JUSTIFY>Forward the request file to the
appropriate CA.  This could be your SimpleCA created for use with
MyProxy – see MyProxy installation.  The CA will issue a
certificate file.  Copy this file as
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf/certs/sm-cert.pem</SPAN></FONT>.<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">
</SPAN></FONT> The request<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">
</FONT>file can be deleted once a certificate has been obtained from
the CA.</P>
<P CLASS="western" ALIGN=JUSTIFY>Repeat this process for the
Attribute Authority, selecting ‘AttributeAuthority’ for the
Common Name<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.</SPAN></FONT></P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl genrsa –out aa-key.pem 2048</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			chmod 400 aa-key.pem</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl req –new –key aa-key.pem –out aa.csr</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>It is recommended that the Session
Manager is run over https to keep user login credentials secured.   A
server certificate and key will be required in addition to enable
this.  
</P>
<P CLASS="western" ALIGN=JUSTIFY>If required, a certificate could be
issued from your SimpleCA.  Follow the same procedure as used for the
Session Manager and Attirbute Authority above creating a private key
and certificate request.  The private key should be generated without
a password.  When generating the certificate request ensure that the
Common Name is set to the fully qualified name of the server host.</P>
<P CLASS="western" ALIGN=JUSTIFY>Once available the certificate and
private key can be added to the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf/certs
</SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">directory
and can be </FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">referenced
by the Session Manager’s properties file with the </FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Lucida Console">sslCertFile</FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">
and </FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Lucida Console">sslKeyFile</FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">
elements respectively.</FONT></SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY>A copy of the NDG Certificate
Authority’s X.509 certificate is also required.  Obtain this from
the NDG CA administrator and copy it into the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf/certs
</SPAN></FONT>directory.</P>
<P CLASS="western" STYLE="background: #cccccc">Note that all other
trusted NDG partner organisations MUST have copies of your CA
certificate.  If they don't, partner organisations NDG Security
infrastructures will reject requests from your security services.  
CA certificates are referenced in the Attribute Authority and Session
Manager properties file settings  <FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2>sslCACertDir</FONT></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">
</FONT></FONT><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2>and
</FONT></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2>caCertFileList</FONT></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">.</FONT></FONT><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2>
 Configuration for Gatekeepers may also need to reference your CA
certificate.</FONT></FONT></P>
<H3 CLASS="western"><A NAME="4.2.4. Session Manager Configuration|outline"></A>
4.2.4 Session Manager Configuration</H3>
<P CLASS="western" ALIGN=JUSTIFY>Configuration parameters may be set
via a properties file.  In addition, the Session Manager can
optionally make use of a Credential Repository database.  This
enables the credentials that users acquire during a session to be
stored so that they may be retrieved.   When installed, the default
configuration set in the Session Manager Properties file is to <I>not</I>
use a Credential Repository.   If this is the case, skip this
section.</P>
<H4 CLASS="western"><A NAME="_Ref156702859"></A>4.2.4.1 Session
Manager Credential Repository</H4>
<P CLASS="western" ALIGN=JUSTIFY>Create the Credential Repository
database.  In the example below a MySQL database is assumed.   Notes
on installing MySQL are given in the Appendices section 5.2. 
</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			mysql –u root –p</FONT></P>
			<P CLASS="western" ALIGN=JUSTIFY>mysql&gt; create database
			ndgCredRepos;</P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>Use the script 
init-credrepos-db to create the tables.  As the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">globus</SPAN></FONT>
user, run the script.  Enter the password for the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndgUser</SPAN></FONT>
account when prompted and type <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">yes</SPAN></FONT>
to confirm creation of the tables:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			init-credrepos-db –u root</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Database
			password:</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Are
			you sure you want to initialise the database tables? (yes/no) yes</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Tables
			created</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>To check that the tables have
been created, restart the database client:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm">$
			mysql –u root –p –D ndgCredRepos</P>
			<P CLASS="western" ALIGN=JUSTIFY STYLE="margin-bottom: 0cm">mysql&gt;
			show tables;</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">+------------------------+</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">|
			Tables_in_ndgCredRepos |</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">+------------------------+</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">|
			UserCredential         |</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">|
			UserID                 |</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">+------------------------+</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">2
			rows in set (0.00 sec)</FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>A separate account should be created
for the Session Manager to access the database.  It should have
sufficient permissions to be able to read and write records.  For
details of how to create an account in MySQL see the Appendices
section 5.2.9.</P>
<H4 CLASS="western">4.2.4.2 Session Manager Properties File Settings</H4>
<P CLASS="western" ALIGN=JUSTIFY>Edit <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">sessionMgrProperties.xml</SPAN></FONT>
in <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf</SPAN></FONT>
and modify the default settings:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;?xml
			version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sessMgrProp&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;portNum&gt;&lt;/portNum&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;useSSL&gt;Yes&lt;/useSSL&gt;
			&lt;!-- leave blank to use http --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sslCertFile&gt;$NDGSEC_DIR/conf/certs/server-cert.pem&lt;/sslCertFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sslKeyFile&gt;&gt;$NDGSEC_DIR/conf/certs/server-key.pem
			&lt;/sslKeyFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			<BR>    </FONT></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Directory
			containing CA cert.s to verify SSL peer cert against - ignored if
			useSSL is blank --&gt;<BR>   
			&lt;sslCACertDir&gt;$NDGSEC_DIR/conf/certs/ca&lt;/sslCACertDir&gt;<BR>
			   </FONT></FONT><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">PKI
			settings for signature of outbound SOAP messages</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;useSignatureHandler&gt;Yes&lt;/useSignatureHandler&gt;
			&lt;!-- leave blank for no signature --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;certFile&gt;&gt;$NDGSEC_DIR/conf/certs/sm-cert.pem&lt;/certFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;keyFile&gt;&gt;$NDGSEC_DIR/conf/certs/server-key.pem&lt;/keyFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;keyPwd&gt;&lt;/keyPwd&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif">CA
			Certificates used to verify X.509 certs used in peer SOAP
			messages,<BR>    SSL connections and Attribute Certificates<BR>   
			--&gt;<BR>    &lt;caCertFileList&gt;<BR>        
			&lt;caCertFile&gt;$NDGSEC_DIR/conf/certs/cacert.pem&lt;/caCertFile&gt;<BR>
			   &lt;/caCertFileList&gt;<BR></FONT>    &lt;!-- </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Set
			the certificate used to verify the signature of messages from the </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">client.
			 This can usually be left blank since the client is expected to </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">include
			the cert with the signature in the inbound SOAP message</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;clntCertFile&gt;&lt;/clntCertFile&gt;
			   </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sessMgrEncrKey&gt;&lt;/sessMgrEncrKey&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sessMgrURI&gt;&lt;/sessMgrURI&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;cookieDomain&gt;&lt;/cookieDomain&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;myProxyProp&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Delete
			this element and take setting from MYPROXY_SERVER environment </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">variable
			if required</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;hostname&gt;ENTER
			THE FULLY QUALIFIED HOSTNAME OF THE SERVER&lt;/hostname&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Delete
			this element to take default setting 7512 or read </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="fr-FR">MYPROXY_SERVER_PORT
			setting</SPAN></FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;port&gt;7512&lt;/port&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Useful
			if hostname and certificate CN don't match correctly.  Globus </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">host
			DN is set to &quot;host/&lt;fqdn&gt;&quot;.  Delete this element
			and set from </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">MYPROXY_SERVER_DN
			environment variable if prefered</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;serverDN&gt;&lt;/serverDN&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Set
			&quot;host/&quot; prefix to host cert CN as is default with globus</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;serverCNprefix&gt;host/&lt;/serverCNprefix&gt;	</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">This
			directory path is used to locate the OpenSSL configuration file</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">The
			settings are used to set up the defaults for the Distinguished
			Name of</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">the
			new proxy cert. issued </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">           
			</P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">GLOBUS_LOCATION
			or GRID_SECURITY_DIR environment variables may be used</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">but
			the settings can be independent of any Globus installation</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><BR>
			          --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;openSSLConfFilePath&gt;$NDGSEC_DIR/conf/openssl.conf&lt;/openSSLConfFilePath&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;tmpDir&gt;/tmp&lt;/tmpDir&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			          Limit on maximum lifetime any proxy certificate can have
			- </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			          specified when a certificate is first created by store()
			method</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;proxyCertMaxLifetime&gt;24&lt;/proxyCertMaxLifetime&gt;
			&lt;!-- in hours --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			          Life time of a proxy certificate when issued from the
			Proxy Server </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			          with getDelegation() method</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			          --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;proxyCertLifetime&gt;8&lt;/proxyCertLifetime&gt;
			&lt;!-- in hours --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">          
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><SPAN LANG="fr-FR">&lt;caCertFile&gt;$NDGSEC_DIR/conf/certs/cacert.pem&lt;/caCertFile&gt;</SPAN></FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	&lt;/myProxyProp&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	&lt;simpleCACltProp&gt;
			</FONT></FONT>
			</P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;uri&gt;&lt;/uri&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;xmlSigKeyFile&gt;&lt;/xmlSigKeyFile&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;xmlSigCertFile&gt;&lt;/xmlSigCertFile&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;xmlSigCertPwd&gt;&lt;/xmlSigCertPwd&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;/simpleCACltProp&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	&lt;!--</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	&lt;simpleCASrvProp&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;certExpiryDate&gt;&lt;/certExpiryDate&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;certLifetimeDays&gt;&lt;/certLifetimeDays&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;certTmpDir&gt;&lt;/certTmpDir&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;caCertFile&gt;&lt;/caCertFile&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;signExe&gt;&lt;/signExe&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;path&gt;&lt;/path&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	&lt;/simpleCASrvProp&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	--&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;credReposProp&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;modFilePath&gt;&lt;/modFilePath&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;modName&gt;ndg.security.common.CredWallet&lt;/modName&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;className&gt;NullCredRepos&lt;/className&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">	
			   &lt;propFile&gt;&lt;/propFile&gt;</FONT></FONT></P>
			<P LANG="fr-FR" STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;/credReposProp&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;/sessMgrProp&gt;</FONT></FONT></P>
			<P> 
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY><B>Notes</B></P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">The
	property file reading software will expand any environment variables
	included in the file.</FONT></SPAN></FONT></P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">openssl.conf</SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT FACE="Helvetica, sans-serif">
	file uses the standard OpenSSL configuration file format.  It is
	used by the Session Manager MyProxy client to formulate a
	certificate request for a proxy certificate generated for a users
	session when they login.  An example is given below.  The important
	section to reference is </FONT></SPAN></FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">[
	req_distinguished_name ]</SPAN></FONT></P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			SSLeay example configuration file.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			This is mostly being used for generation of certificate requests.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">RANDFILE
			               = $ENV::HOME/.rnd</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">####################################################################</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			ca ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_ca
			     = CA_default            # The default ca section</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">####################################################################</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			CA_default ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">dir
			            = ./demoCA              # Where everything is kept</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">certs
			          = $dir/certs            # Where the issued certs are
			kept</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">crl_dir
			        = $dir/crl              # Where the issued crl are kept</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">database
			       = $dir/index.txt        # database index file.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">new_certs_dir
			  = $dir/newcerts         # default place for new certs.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">certificate
			    = $dir/cacert.pem       # The CA certificate</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">serial
			         = $dir/serial           # The current serial number</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">crl
			            = $dir/crl.pem          # The current CRL</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">private_key
			    = $dir/private/cakey.pem# The private key</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">RANDFILE
			       = $dir/private/.rand    # private random number file</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">x509_extensions
			= x509v3_extensions     # The extentions to add to the cert</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_days
			   = 365                   # how long to certify for</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_crl_days=
			365 # DEE 30  # how long before next CRL</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_md
			     = md5                   # which md to use.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">preserve
			       = no                    # keep passed DN ordering</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			A few difference way of specifying how similar the request should
			look</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			For type CA, the listed attributes must be the same, and the
			optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			and supplied fields are just that :-)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">policy
			         = policy_match</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			For the CA policy</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			policy_match ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">countryName
			            = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">stateOrProvinceName
			    = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">organizationName
			       = match</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">organizationalUnitName
			 = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">commonName
			             = supplied</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">emailAddress
			           = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			For the 'anything' policy</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			At this point in time, you must list all acceptable 'object'</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			types.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			policy_anything ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">countryName
			            = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">stateOrProvinceName
			    = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">localityName
			           = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">organizationName
			       = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">organizationalUnitName
			 = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">commonName
			             = supplied</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">emailAddress
			           = optional</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">####################################################################</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			req ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_bits
			           = 1024</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">default_keyfile
			        = privkey.pem</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">distinguished_name
			     = req_distinguished_name</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">req_extensions
			         = v3_req</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			req_distinguished_name ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			BEGIN CONFIG</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">0.organizationName
			              = Level 0 Organization</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">0.organizationName_default
			      = NDG</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">0.organizationalUnitName
			         = Level 0 Organizational Unit</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">0.organizationalUnitName_default
			= BADC</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#1.organizationalUnitName
			         = Level 1 Organizational Unit</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#1.organizationalUnitName_default
			= localdomain</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">commonName
			                     = Name (e.g., John M. Smith)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">commonName_max
			                 = 64</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">#
			END CONFIG</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">[
			v3_req ]</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">nsCertType
			                     = objsign,email,server,client</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2 STYLE="font-size: 9pt">basicConstraints
			               = critical,CA:false</FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H4 CLASS="western"><A NAME="_Ref175134983"></A><A NAME="_Ref179772391"></A>
4.2.4.3 SysV-style Boot Script</H4>
<P CLASS="western" ALIGN=JUSTIFY>The Session Manager can be
configured to start up at system boot of the host machine.  A SysV
style start up script <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg-sm</SPAN></FONT>
is provided in the installation in:</P>
<P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/usr/local/lib/python</SPAN></FONT>&lt;python
version num&gt;<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/site-packages/ndg_security_server</SPAN></FONT>-&lt;version
info&gt;<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.egg/ndg/security/server/share
 </SPAN></FONT>
</P>
<P CLASS="western" ALIGN=JUSTIFY>To configure, install this file:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			cp /usr/local/lib/python&lt;python version
			num&gt;/site-packages/ndg_security_server-&lt;version
			info&gt;.egg/ndg/security/server<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">
			/share/ndg-sm /etc/rc.d/init.d</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$
			chkconfig --add ndg-sm</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Edit the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg-sm</SPAN></FONT>
so that it uses the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">NDGSEC_DIR</SPAN></FONT>
environment variable to point to the correct location of the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.tac</SPAN></FONT>
file in the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">conf/</SPAN></FONT>
directory. User and group ID settings can be made to run under
alternative account to root.  If used ensure that <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR</SPAN></FONT>
is set with the necessary permissions to enable access.  
</P>
<P CLASS="western" ALIGN=JUSTIFY>Note that the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">chkconfig</SPAN></FONT>
command may not be available on your target machine.  Please refer to
instructions for your particular Linux distribution.</P>
<H3 CLASS="western"><A NAME="4.2.5. Attribute Authority Configuration|outline"></A>
4.2.5 Attribute Authority Configuration</H3>
<P CLASS="western" ALIGN=JUSTIFY>The Attribute Authority also has a
properties file for the setting of configuration parameters.</P>
<H4 CLASS="western">4.2.5.1Attribute Authority Properties File
Settings</H4>
<P CLASS="western" ALIGN=JUSTIFY>Edit <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attAuthorityProperties.xml</SPAN></FONT>
in <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf</SPAN></FONT>
and modify the default settings:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;?xml
			version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;AAprop&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">'name'
			setting MUST agree with map config file 'thisHost' name attribute</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;name&gt;Organisation
			Identifier&lt;/name&gt; </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;portNum&gt;SELECT
			A SUITABLE PORT NUMBER FOR RUNNING THE SERVICE&lt;/portNum&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">PKI
			settings for transport level encryption</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;useSSL&gt;&lt;/useSSL&gt;
			&lt;!-- leave blank to use http --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sslCertFile&gt;&lt;/sslCertFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sslKeyFile&gt;&lt;/sslKeyFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;sslKeyPwd&gt;&lt;/sslKeyPwd&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif">&lt;!--
			<BR>       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif">Directory
			containing CA cert.s to verify SSL peer cert against - ignored if
			useSSL is blank --&gt;<BR>      
			&lt;sslCACertDir&gt;$NDGSEC_DIR/conf/certs/ca&lt;/sslCACertDir&gt;<BR></FONT>
			   &lt;!--</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">PKI
			settings for signature of outbound SOAP messages</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;useSignatureHandler&gt;Yes&lt;/useSignatureHandler&gt;
			&lt;!-- leave blank for no signature --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">         <FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">         <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><FONT FACE="Lucida Console, DejaVu Sans Mono, sans-serif">CA
			Certificates used to verify X.509 certs used in peer SOAP
			messages,<BR>         SSL connections and Attribute Certificates<BR>
			        --&gt;<BR>        &lt;caCertFileList&gt;<BR>            
			&lt;caCertFile&gt;$NDGSEC_DIR/conf/certs/cacert.pem&lt;/caCertFile&gt;<BR>
			       &lt;/caCertFileList&gt;<BR></FONT>   
			&lt;keyFile&gt;$NDGSEC_DIR/conf/certs/aa-key.pem &lt;/keyFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;keyPwd&gt;&lt;/keyPwd&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;caCertFile&gt;$NDGSEC_DIR/conf/certs/cacert.pem
			&lt;/caCertFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Set
			the certificate used to verify the signature of messages from the </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">client.
			 This can usually be left blank since the client is expected to </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">include
			the cert with the signature in the inbound SOAP message</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;clntCertFile&gt;&lt;/clntCertFile&gt;
			   </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;attCertLifetime&gt;86400&lt;/attCertLifetime&gt;
			&lt;!-- Measured in seconds --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Allow
			an offset for clock skew between servers running </FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">security
			services.  - Use minus sign for time in the past</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;attCertNotBeforeOff&gt;0&lt;/attCertNotBeforeOff&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			Location of role mapping file --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;mapConfigFile&gt;$NDGSEC_DIR/conf/mapConfig.xml&lt;/mapConfigFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			All Attribute Certificates issued are recorded in this dir --&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;attCertDir&gt;$NDGSEC_DIR/conf/attCertLog&lt;/attCertDir&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Files
			in attCertDir are stored using a rotating file handler</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">attCertFileLogCnt
			sets the max number of files created before the first is</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">overwritten</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;attCertFileName&gt;ac.xml&lt;/attCertFileName&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;attCertFileLogCnt&gt;1024&lt;/attCertFileLogCnt&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;dnSeparator&gt;/&lt;/dnSeparator&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;!--
			</FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">Settings
			for custom AAUserRoles derived class to get user roles for</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">given
			user ID</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">--&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;userRolesModFilePath&gt;$NDGSEC_DIR/conf&lt;/userRolesModFilePath&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;userRolesModName&gt;userRoles&lt;/userRolesModName&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;userRolesClassName&gt;UserRoles&lt;/userRolesClassName&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm">   
			<FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;userRolesPropFile&gt;$NDGSEC_DIR/conf/userRoles.cfg&lt;/userRolesPropFile&gt;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Monospace"><FONT SIZE=2 STYLE="font-size: 9pt">&lt;/AAprop&gt;</FONT></FONT></P>
			<P> 
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H4 CLASS="western">4.2.5.2 User Roles Interface</H4>
<P CLASS="western" ALIGN=JUSTIFY>The Attribute Authority given a
valid user proxy certificate serves an attribute certificate
containing authorisation roles for that user.  It is for the data
centre to determine how these roles map to the users identity as
given by their Distinguished Name given in the proxy certificate. 
Typically, a data centre might have a user database which relates
user id to authorisation roles.</P>
<P CLASS="western" ALIGN=JUSTIFY>The Attribute Authority provides a
programmatic interface to determine the roles to user id
relationship.   A custom python class may be written to perform this
task.   See the Appendices section 5.5.</P>
<H4 CLASS="western">4.2.5.3 Role Mapping</H4>
<P CLASS="western" ALIGN=JUSTIFY>The role mapping file is stored in
the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$NDGSEC_DIR/conf</SPAN></FONT>
directory as <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mapConfig.xml</SPAN></FONT>.
 This is an XML file which relates local roles at the target data
centre to roles of other trusted data centres.  These role mapping
are made by agreement between data centres.</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;?xml
			version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;AAmap&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;thisHost
			name=&quot;yourSiteIdentifier&quot;&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaURI&gt;yourSiteAttAuthorityURI&lt;/aaURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaDN&gt;the
			DN for the Attribute Authority’s X.509 Cert.&lt;/aaDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginURI&gt;Your
			Site Login Page URI (https expected)&lt;/loginURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginServerDN&gt;The
			DN of loginURI’s SSL cert.&lt;/loginServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">              <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			cert. DN for SSL server making a request to loginURI</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">     <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/thisHost&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;trusted
			name=&quot;BODC&quot;&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaURI&gt;bodcAttAuthorityURI&lt;/aaURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaDN&gt;the
			DN for the Attribute Authority’s X.509 Cert.&lt;/aaDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginURI&gt;BODC’s
			Login Page URI&lt;/loginURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginServerDN&gt;The
			DN of loginURI’s SSL cert.&lt;/loginServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">              <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			cert. DN for SSL server making a request to loginURI</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;role
			remote=&quot;aBODCrole&quot; local=&quot;aLocalRole&quot;/&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/trusted&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;trusted
			name=&quot;NOCS&quot;&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaURI&gt;nocsAttAuthorityURI&lt;/aaURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaDN&gt;the
			DN for the Attribute Authority’s X.509 Cert.&lt;/aaDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginURI&gt;nocsLoginPageURI&lt;/loginURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginServerDN&gt;The
			DN of loginURI’s SSL cert.&lt;/loginServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">              <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			cert. DN for SSL server making a request to loginURI</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;role
			remote=&quot;aNOCSrole&quot; local=&quot;anotherLocalRole&quot;/&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/trusted&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;trusted
			name=&quot;NEODAAS&quot;&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaURI&gt;neodaasAttAuthorityURI&lt;/aaURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;aaDN&gt;the
			DN for the Attribute Authority’s X.509 Cert.&lt;/aaDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">         
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginURI&gt;neodaasLoginPageURI&lt;/loginURI&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginServerDN&gt;The
			DN of loginURI’s SSL cert.&lt;/loginServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">              <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">The
			cert. DN for SSL server making a request to loginURI</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/loginRequestServerDN&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">          <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;role
			remote=&quot;neodaasRole&quot; local=&quot;yetAnotherLocalRole&quot;/&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/trusted&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">&lt;/AAmap&gt;</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The map file contains an entry for
each site that the Attribute Authority trusts.  These are listed
using the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">trusted</SPAN></FONT>
element name.  The Attribute Authority identifies itself with the
similar <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">thisHost</SPAN></FONT>
element.  Each uses a name attribute to uniquely identify the
organisation.  The example above shows a BADC map file which trusts
the organisations BODC, NOCS and NEODAAS.</P>
<P CLASS="western" ALIGN=JUSTIFY>Note that the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">thisHost
name </SPAN></FONT>attribute should match the name element in the
corresponding <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attAuthorityProperties.xml</SPAN></FONT>
file.  <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">name</SPAN></FONT>
is copied as the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">issuerName</SPAN></FONT>
used in Attribute Certificates issued by the Attribute Authority.</P>
<P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">thisHost</SPAN></FONT>
and trusted elements share all the same sub-elements barring role. 
</P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">aaURI</SPAN></FONT>
	– this is the address of the Attribute Authority</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">aaDN</SPAN></FONT>
	– the Distinguished Name of the Attribute Authority’s X.509
	certificate (not currently used)</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">loginURI</SPAN></FONT>
	– the address of the Login Service 
	</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">loginServerDN</SPAN></FONT>
	– the Distinguished Name of the X.509 certificate held by the
	Login Service for SSL connections.  It is expected that the Login
	Service is run over https to protect the privacy of login
	credentials.  This field is not currently used.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">loginRequestServerDN</SPAN></FONT>
	– on request for secured credentials a service provider enables
	the user to redirect to their chosen Login Service at another
	trusted site.   The on successful authentication the Login Service
	can return the user back to the service provider to enable them to
	continue with their request.  This return to address must be over
	https to enable credentials to be encrypted for the transit but also
	to validate service provider host making the request.   The Login
	Service carries this out by checking the SSL certificate of the
	service provider host and checking its Distinguished Name against
	the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">loginRequestServerDN</SPAN></FONT>
	entries for the organisations it trusts.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">role</SPAN></FONT>
	– this element is used to express an individual role mapping.  The
	<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">local</SPAN></FONT>
	attribute refers to a role <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">thisHost</SPAN></FONT>
	supports.  The <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">remote</SPAN></FONT>
	attribute is assigned to the role of the trusted organisation it
	maps to.  It is possible to have multiple role entries.  One local
	role may map to many remote roles and vice versa: one remote role
	may map to many local roles.</P>
</UL>
<H4 CLASS="western">4.2.5.4 Twisted Python server .tac file</H4>
<P CLASS="western" ALIGN=JUSTIFY>Copy this from the
ndg_security_server to the NDG security conf/ area:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			cp /usr/local/lib/python&lt;python version
			num&gt;/site-packages/ndg_security_server-&lt;version
			info&gt;.egg/ndg/security/server/server-config.tac<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">
			$NDGSEC_DIR/conf</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H4 CLASS="western"><A NAME="_Ref179772414"></A>4.2.5.5 SysV-style
Boot Script</H4>
<P CLASS="western" ALIGN=JUSTIFY>As with the Session Manager, the
Attribute Authority can be configured to start up at system boot of
the host machine.  A SysV style start up script <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg-aa</SPAN></FONT>
is provided in the installation in:</P>
<P CLASS="western" ALIGN=JUSTIFY>/usr/local/lib/python&lt;python
version num&gt;/site-packages/ndg_security_server-&lt;version
info&gt;.egg/ndg/security/server/<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">share</SPAN></FONT>
 
</P>
<P CLASS="western" ALIGN=JUSTIFY>To configure, install this file:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			cp /usr/local/lib/python&lt;python version
			num&gt;/site-packages/ndg_security_server-&lt;version
			info&gt;.egg/ndg/security/server<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">
			/share/ndg-aa /etc/rc.d/init.d</SPAN></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$
			chkconfig --add ndg-aa</SPAN></FONT></FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Edit the ndg-aa so that it uses the
NDGSEC_DIR environment variable to point to the correct location of
the .tac file in the conf/ directory.  User and group ID settings can
be made to run under alternative account to root.  If used ensure
that $NDGSEC_DIR is set with the necessary permissions to enable
access.  
</P>
<P CLASS="western" ALIGN=JUSTIFY>If required, add any additional
environment settings required to connect to a user database.</P>
<H3 CLASS="western"><A NAME="4.2.6. Python Unit Tests|outline"></A>4.2.6
Python Unit Tests</H3>
<P CLASS="western" ALIGN=JUSTIFY>Python unit test scripts are
provided to enable the system to be checked to confirm that it is
running correctly.   These are located in the ndg_security_test egg
in the site-packages/ directory of the python installation.</P>
<P CLASS="western" ALIGN=JUSTIFY>&lt;todo: &gt;</P>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<H1 CLASS="western"><A NAME="5.Appendices|outline"></A>5.Appendices</H1>
<H2 CLASS="western"><A NAME="5.1. Postgres PAM for MyProxy|outline"></A>
5.1 Postgres PAM for MyProxy</H2>
<P CLASS="western" ALIGN=JUSTIFY>This section is intended to provide
the information needed to enable MyProxy to authenticate against
tables in a Postgres database.  Before, making these settings ensure
that MyProxy is fully installed following the steps outlined in the
MyProxy section.  It's recommended to try out MyProxy with an
existing PAM such as “logon” first to ensure it is working.  See
the section <I>Testing MyProxy</I>.</P>
<P CLASS="western" ALIGN=JUSTIFY>Obtain and install the latest
libpam_pgsql.  This can be installed from Debian or RPM packages or
from source.   For NDG Security, version 0.5.2-9 Debian and 0.6.3
source distributions have been tested.  Check the documentation in
the source tar ball for details of Postgres version requirements.  
</P>
<H3 CLASS="western"><A NAME="5.1.1. Configuration|outline"></A>5.1.1
Configuration</H3>
<P CLASS="western" ALIGN=JUSTIFY>Depending on your native system
create either a /etc/pam.d/myproxy file or the relevant entry in
/etc/pam.conf 
</P>
<P CLASS="western" ALIGN=JUSTIFY>For /etc/pam.d/myproxy:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">auth  
			      required   pam_pgsql.so <BR>account    required  
			pam_pgsql.so<BR><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">password
			required   pam_pgsql.so</SPAN></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>or /etc/pam.conf:</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">myproxy
			auth         required   pam_pgsql.so <BR>myproxy account   
			required   pam_pgsql.so<BR>myproxy <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">password
			required   pam_pgsql.so</SPAN></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Configure the database, and table
the module should use with the configuration file
/etc/pam_pgsql.conf. e.g.</P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">database
			= userdb<BR>user = admin<BR>password = adminpassword<BR>table =
			account<BR>user_column = username<BR>pwd_column = password<BR>pw_type
			= md5<BR><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">debug</SPAN></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>In the above example, password in
the database table “account” are MD5 encrypted.   This field can
also be set to Crypt or left out altogether if passwords are
unencrypted.</P>
<P CLASS="western" ALIGN=JUSTIFY>Restart MyProxy and test it using
the myproxy-logon client command as outlined in the section <I>Testing
MyProxy.</I><SPAN STYLE="font-style: normal">   To specify a database
account name use the -l flag.  If this omitted then the Linux account
name is assumed e.g.</SPAN></P>
<TABLE WIDTH=618 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=602>
	<TR>
		<TD WIDTH=602 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">$
			myproxy-logon -v -p 60000 -l mydbaccountid</SPAN></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western"><BR>Consult the myproxy-logon and myproxy-server
output and the system logs to trouble shoot errors.</P>
<H2 CLASS="western"><A NAME="_Ref133718491"></A><A NAME="5.2. MySQL Installation|outline"></A>
5.2 MySQL Installation</H2>
<P CLASS="western" ALIGN=JUSTIFY>MySQL can be used to implement a
Credential Repository for the SessionManager to stored user
credentials as cached in their Credential Wallet held in their
session.</P>
<P CLASS="western" ALIGN=JUSTIFY>This section describes how to make
an installation from the MySQL binary package tarball.   System
administrators may wish to use an existing installation of MySQL or
use an alternative installation method such as rpm.  Installing from
the binary package has the advantage that it doesn’t interfere with
any existing MySQL installation on the target machine.   The
instructions are adapted from the file <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">INSTALL-BINARY</SPAN></FONT>
provided in the tarball.</P>
<H3 CLASS="western"><A NAME="5.2.1.Version|outline"></A>5.2.1Version</H3>
<P CLASS="western" ALIGN=LEFT>Version 3.23 or later is recommended. 
These instructions are for version 5.0.20a, the latest stable release
at time of writing.</P>
<H3 CLASS="western"><A NAME="5.2.2. Getting the Binaries|outline"></A>
5.2.2 Getting the Binaries</H3>
<P CLASS="western" ALIGN=LEFT>The package can be obtained from the
MySQL web site (<FONT COLOR="#0000ff"><U><A HREF="http://dev.mysql.com/downloads/mysql/5.0.html">http://dev.mysql.com/downloads/mysql/5.0.html</A></U></FONT>).
 Scroll to the correct version - Linux (non RPM, Intel C/C++
compiled, glibc-X.X) downloads.  The version of glibc on the target
machine can be checked using same machine as the web server.</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			ls /lib/libc-*</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<H3 CLASS="western"><A NAME="5.2.3. New mysql User Account|outline"></A>
5.2.3 New <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><I>mysql</I></SPAN></FONT>
User Account</H3>
<P CLASS="western" ALIGN=JUSTIFY>Make a new account to run MySQL if
it doesn’t already exist:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			groupadd mysql<BR>$ useradd -g mysql mysql</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H3 CLASS="western"><A NAME="5.2.4. Unpacking the tarball|outline"></A>
5.2.4 Unpacking the tarball</H3>
<P CLASS="western" ALIGN=LEFT>As root copy the tarball to the target
directory for installation e.g. /usr/local, unpack the file:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			cd /usr/local<BR>$ tar zxvf
			mysql-standard-5.0.20a-linux-i686-icc-glibc23.tar.gz</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>Make a symbolic link to the new
directory and ‘<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">cd</SPAN></FONT>’
to it: 
</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			ln -s /usr/local/mysql-standard-5.0.20a-linux-i686-icc-glibc23
			mysql<BR>$ cd mysql</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>The <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">bin</SPAN></FONT>
directory contains client programs and the server.  You should add
the full pathname of this directory to your <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">PATH</SPAN></FONT>
environment variable so that your shell finds the MySQL programs
properly. 
</P>
<H3 CLASS="western"><A NAME="5.2.5. Configuration File|outline"></A>5.2.5
Configuration File</H3>
<P CLASS="western" ALIGN=JUSTIFY>Create a configuration file called
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">my.cnf</SPAN></FONT>
in the target directory (<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/usr/local/mysql</SPAN></FONT>
in this example) to enable custom settings to be made for this
installation.  Note that if there is an existing installation of
MySQL, there may be settings existing settings in a file <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/my.cnf</SPAN></FONT>.
 To use the settings from this file, <I>ignore</I> this step.</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">[mysqld]</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">datadir=/usr/local/mysql-standard-5.0.20a-linux-i686-icc-glibc23/data</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">socket=/tmp/mysql.sock</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			Default to using old password format for compatibility with mysql
			3.x</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			clients (those using the mysqlclient10 compatibility package).</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">old_passwords=1</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">[mysql.server]</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">user=mysql</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">basedir=/usr/local/mysql-standard-5.0.20a-linux-i686-icc-glibc23</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">[mysqld_safe]</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">err-log=/var/log/mysqld.log</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">pid-file=/tmp/mysql.pid</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The settings above will mean that
MySQL’s tables and the Credential Repository database will be
stored under <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/usr/local/mysql/data</SPAN></FONT>.</P>
<H3 CLASS="western"><A NAME="5.2.6. Create the Grant Tables|outline"></A>
5.2.6 Create the Grant Tables</H3>
<P CLASS="western" ALIGN=LEFT>The <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">scripts</SPAN></FONT>
directory contains the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysql_install_db</SPAN></FONT>
script used to initialize the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysql</SPAN></FONT>
database containing the grant tables that store the server access
permissions.  If you have not installed MySQL before, you must create
the MySQL grant tables:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			scripts/mysql_install_db --user=mysql</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>If you run the command as <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">root</SPAN></FONT>,
you must use the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">--user</SPAN></FONT>
option as shown. The value of the option should be the name of the
login account that you created in the first step to use for running
the server. If you run the command while logged in as that user, you
can omit the -user option.  After creating or updating the grant
tables, you need to restart the server manually.</P>
<H3 CLASS="western"><A NAME="5.2.7. File and Directory Permissions|outline"></A>
5.2.7 File and Directory Permissions</H3>
<P CLASS="western" ALIGN=LEFT>Change the ownership of program
binaries to <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">root</SPAN></FONT>
and ownership of the data directory <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysql</SPAN></FONT>.
   Assuming that you are located in the installation directory
(<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/usr/local/mysql</SPAN></FONT>),
the commands look like this:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>$
			chown -R root  .<BR>$ chown -R mysql data<BR>$ chgrp -R mysql .</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>The first command changes the owner
attribute of the files to the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">root</SPAN></FONT>
user. The second changes the owner attribute of the data directory to
the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysql</SPAN></FONT>
user. The third changes the group attribute to the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysql</SPAN></FONT>
group.</P>
<H3 CLASS="western"><A NAME="5.2.8. Starting the Server|outline"></A>5.2.8
Starting the Server</H3>
<P CLASS="western" ALIGN=LEFT>If you want MySQL to start
automatically when you boot your machine, you can copy
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">support-files/mysql.server</SPAN></FONT>
to the location where your system has its startup files. More
information can be found in the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">support-files/mysql.server</SPAN></FONT>
script itself.</P>
<P CLASS="western" ALIGN=LEFT>To start the MySQL server, use the
following command:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><BR><BR>
			</P>
			<P LANG="nb-NO"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			bin/mysqld_safe --user=mysql &amp;</FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="nb-NO" CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>If that command fails immediately and
prints <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">mysqld
ended</SPAN></FONT>, you can find some information in the
&lt;hostname&gt;<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.err</SPAN></FONT>
file in the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">data</SPAN></FONT>
directory.</P>
<H3 CLASS="western"><A NAME="_Ref133893123"></A><A NAME="5.2.9. Securing MySQL Accounts|outline"></A>
5.2.9 Securing MySQL Accounts</H3>
<P CLASS="western" ALIGN=JUSTIFY>To delete the anonymous accounts:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			mysql -u root</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">mysql&gt;
			DELETE FROM mysql.user WHERE User = '';</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">mysql&gt;
			FLUSH PRIVILEGES;</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Set the password for the root
account:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">mysql&gt;
			SET PASSWORD FOR 'root'@'localhost' = PASSWORD('newpwd');</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">mysql&gt;
			SET PASSWORD FOR 'root'@'<I>hostname</I>' = PASSWORD('newpwd');</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>The hostname can be checked using
the query:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>mysql&gt;
			SELECT Host, User FROM mysql.user;</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>Add a new account for use with the
Credential Repository database e.g.</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>mysql&gt;
			GRANT SELECT, UPDATE, INSERT, DELETE ON ndgCredRepos.* TO
			'ndgUser'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR>The above statement grants the
user, <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndgUser</SPAN></FONT>
with password, <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">password</SPAN></FONT>,
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">select</SPAN></FONT>,
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">update</SPAN></FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">insert</SPAN></FONT>
privileges on the tables of database <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndgCredRepos</SPAN></FONT>.
 The user may only connect from the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">localhost</SPAN></FONT>.
 Hence, in this case the Session Manager and Credential Repository
must be installed on the same machine.  To allow the Credential
Repository to run on a separate machine to the Session Manager, the
account must have permission to connect remotely.  This can be
achieved by altering the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">GRANT</SPAN></FONT>
statement above to:</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><BR>mysql&gt;
			GRANT SELECT, UPDATE, INSERT, DELETE ON ndgCredRepos.* TO
			'ndgUser'@’%’ IDENTIFIED BY 'password' WITH GRANT OPTION;</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=LEFT>You also can set up new accounts using
the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">bin/mysql_setpermission</SPAN></FONT>
script if you install the `DBI' and `DBD::mysql' Perl modules.</P>
<P CLASS="western" ALIGN=LEFT>See section 4.2.4.1 for details about
creation of the Credential Repository database.</P>
<H3 CLASS="western"><A NAME="5.2.10. Server Automated Start up|outline"></A>
5.2.10 Server Automated Start up</H3>
<P CLASS="western" ALIGN=JUSTIFY>&lt;todo: &gt;</P>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<H2 CLASS="western"><A NAME="5.3. HTTPS set-up with Apache Web Server|outline"></A>
5.3 HTTPS set-up with Apache Web Server</H2>
<P CLASS="western" ALIGN=JUSTIFY>NDG security requires HTTPS for the
transfer of user credentials across cookie domains between a data
provider web page requesting user credentials and a user’s NDG home
login page.</P>
<P CLASS="western" ALIGN=JUSTIFY>&lt;todo: full explanation - incl.
mod_ssl must be installed&gt;</P>
<H3 CLASS="western"><A NAME="5.3.1. Web Server Host Certificate Generation|outline"></A>
5.3.1 Web Server Host Certificate Generation</H3>
<P CLASS="western" ALIGN=JUSTIFY>Generate a new private key and
certificate request.</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl genrsa –out server.key 2048</FONT></P>
			<P STYLE="margin-bottom: 0cm"><A NAME="OLE_LINK1"></A><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			openssl req –new –key server.key –out server.csr</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Send the certificate request to the
relevant CA (NDG if appropriate) for signing.</P>
<H3 CLASS="western"><A NAME="5.3.2.Apache Configuration File Settings|outline"></A>
5.3.2Apache Configuration File Settings</H3>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H2 CLASS="western"><A NAME="_Ref132181551"></A><A NAME="5.4. Apache Web Server Proxy Settings Configuration for Web Services|outline"></A>
5.4 Apache Web Server Proxy Settings Configuration for Web Services</H2>
<P CLASS="western" ALIGN=JUSTIFY>Apache provides a convenient
mechanism to re-route web service ports through port 80 and so make
them available to the outside world.   This may be helpful if when
deploying NDG Security you do not wish to open additional ports in
your site firewall settings.</P>
<P CLASS="western" ALIGN=JUSTIFY>Edit the Apache configuration file. 
This should be located at <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">/etc/httpd/conf</SPAN></FONT></P>
<P CLASS="western" ALIGN=JUSTIFY>Add <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ProxyPass</SPAN></FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ProxyPassReverse</SPAN></FONT>
entries for the Session Manager and Attribute Authority web services.
  The first argument after the directive name itself is the directory
that the service will be served from relative to the web server URL. 
So below, if the URL of the web server is <FONT COLOR="#0000ff"><U><A HREF="http://www.badc.rl.ac.uk/">http://www.badc.rl.ac.uk</A></U></FONT>,
then the Session Manager would be available at
<FONT COLOR="#0000ff"><U><A HREF="http://www.badc.rl.ac.uk/sessionMgr">https://www.badc.rl.ac.uk/sessionMgr</A></U></FONT>.
 The second argument is the actual location where the web service is
running locally.  In the example below, the Session Manager is
running on port 5700 on the same machine as the web server.</P>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">#
			Session Manager and Attribute Authority settings</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">ProxyPass
			       /sessionMgr    https://localhost:5700</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">ProxyPassReverse
			/sessionMgr    https://localhost:5700</FONT></P>
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">ProxyPass
			       /attAuthority  http://localhost:5000</FONT></P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">ProxyPassReverse
			/attAuthority  http://localhost:5000</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Restart the Apache web server.  This
can be done in a variety of ways.  As root user:</P>
<OL>
	<LI><P CLASS="western" ALIGN=LEFT>On Redhat machines, using the
	command <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">redhat-config-services</SPAN></FONT>
	or <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">system-config-services</SPAN></FONT>
	 In the GUI, click on httpd in the list and press the Restart button</P>
</OL>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			redhat-config-services</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<OL START=2>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">service
	</SPAN></FONT>command</P>
</OL>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			/sbin/service httpd restart</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<OL START=3>
	<LI><P CLASS="western" ALIGN=JUSTIFY>apache command</P>
</OL>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			apachectl restart</FONT></P>
			<P CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<OL START=4>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Using <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB"><FONT SIZE=2 STYLE="font-size: 9pt">kill</FONT></SPAN></FONT></P>
</OL>
<TABLE WIDTH=621 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=605>
	<TR>
		<TD WIDTH=605 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P LANG="sv-SE" STYLE="margin-bottom: 0cm"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			kill -HUP `cat /etc/httpd/run/httpd.pid`</FONT></P>
			<P LANG="sv-SE" CLASS="western" ALIGN=LEFT><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P LANG="sv-SE" CLASS="western" ALIGN=JUSTIFY STYLE="margin-left: 0.64cm">
<BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Note in the last case that the
location of the pid file will depend on your installation.</P>
<P CLASS="western" ALIGN=JUSTIFY>Once the changes have been made,
ensure that <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">sessionMgr.wsdl</SPAN></FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">attAuthority.wsdl</SPAN></FONT>
contain the new locations for the web services in the tag
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">&lt;soap:address
location=”…”&gt;</SPAN></FONT> 
</P>
<H2 CLASS="western"><A NAME="5.5.An Example Attribute Authority AAUserRoles interface class|outline"></A>
5.5An Example Attribute Authority AAUserRoles interface class</H2>
<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">This
interface is required in order to link the Attribute Authority to the
data centre’s system for identifying registered users and managing
their roles.  The installation comes with a simple test class which
illustrates this.  See ndg.security.server.conf.userRoles.</FONT></P>
<P CLASS="western" ALIGN=JUSTIFY>The class must inherit from the
<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">AAUserRoles</SPAN></FONT>
interface class.  It must override the <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">userIsRegistered</SPAN></FONT>
and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">getRoles</SPAN></FONT>
methods:</P>
<UL>
	<LI VALUE=1><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">userIsRegistered()</SPAN></FONT>
	– returns True if the user with the given input Distinguished Name
	is registered at the site.  This method might contain an SQL query
	to the site’s user database for example.  This method is <I>optional
	</I><SPAN STYLE="font-style: normal">and is not part of the API to
	the Attribute Authority.</SPAN></P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">getRoles()</SPAN></FONT>
	– returns a list of roles to which the user with the given input
	Distinguished Name is enrolled.  Again, this method could be
	implemented with an SQL query to retrieve the roles for a given
	user.  Note, that if not roles are found, the method should return
	[].</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">__init__()</SPAN></FONT>
	– optionally, the initialisation method may be overridden to
	enable for example the setting up of a database connection.   The
	path to a properties file may be passed in.  This could contain
	database connection settings.</P>
</UL>
<P CLASS="western" ALIGN=JUSTIFY>The custom class used by the BODC is
a more detailed example:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0 STYLE="page-break-before: auto">
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>&quot;&quot;&quot;NDG
			Attribute Authority User Roles class - acts as an interface
			between</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>the
			data centre's user roles configuration and the Attribute Authority</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>BODC
			User Roles Interface to Oracle database</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>@author:
			P J Kershaw 09/08/07</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>@copyright:
			(C) 2007 STFC &amp; NERC</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>@licence:
			This software may be distributed under the terms of the Q Public</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>License,
			version 1.0 or later.</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>&quot;&quot;&quot;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#000000">__revision__
			= </FONT><FONT COLOR="#00aa00"><I>'$Id:$'</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">from</FONT><FONT COLOR="#000000">
			ConfigParser </FONT><FONT COLOR="#0000ff">import</FONT><FONT COLOR="#000000">
			SafeConfigParser</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>#
			Use a conditional import here because if the TestUserRoles class
			is used,</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>#
			cx_Oracle is not required</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">import</FONT><FONT COLOR="#000000">
			cx_Oracle</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			ImportError, e:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">from</FONT><FONT COLOR="#000000">
			warnings </FONT><FONT COLOR="#0000ff">import</FONT><FONT COLOR="#000000">
			warn</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>warn(str(e),
			RuntimeWarning)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">pass</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">from</FONT><FONT COLOR="#000000">
			ndg.security.server.AttAuthority </FONT><FONT COLOR="#0000ff">import</FONT><FONT COLOR="#000000">
			AAUserRoles, AAUserRolesError</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">from</FONT><FONT COLOR="#000000">
			ndg.security.common.X509 </FONT><FONT COLOR="#0000ff">import</FONT><FONT COLOR="#000000">
			X500DN</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">class</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>TestUserRoles</B></FONT><FONT COLOR="#000000">(AAUserRoles):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#00aa00"><I>&quot;&quot;&quot;Test
			User Roles class dynamic import for Attribute Authority</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>NOT
			for use on production system&quot;&quot;&quot;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">def</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>__init__</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">,
			propertiesFilePath=</FONT><FONT COLOR="#0000ff">None</FONT><FONT COLOR="#000000">):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">pass</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">def</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>getRoles</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">,
			dn):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#00aa00"><I>&quot;&quot;&quot;Test
			getRoles returns role attributes regardless of user Id!&quot;&quot;&quot;</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Parse username from DN string</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			TODO: this may be e-mail address for BODC?</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>cn
			= X500DN(dn)[</FONT><FONT COLOR="#00aa00"><I>'CN'</I></FONT><FONT COLOR="#000000">]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">if</FONT><FONT COLOR="#000000">
			len(cn) == </FONT><FONT COLOR="#800000">2</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Proxy cert has two common names set - assume extra common </FONT></FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			name will be 'proxy' or a number</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>username=[n
			</FONT><FONT COLOR="#0000ff">for</FONT><FONT COLOR="#000000"> n </FONT><FONT COLOR="#0000ff">in</FONT><FONT COLOR="#000000">
			cn </FONT><FONT COLOR="#0000ff">if</FONT><FONT COLOR="#000000">
			n!=</FONT><FONT COLOR="#00aa00"><I>&quot;proxy&quot;</I></FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#0000ff">and</FONT><FONT COLOR="#000000"> </FONT><FONT COLOR="#0000ff">not</FONT><FONT COLOR="#000000">
			n.isdigit()][</FONT><FONT COLOR="#800000">0</FONT><FONT COLOR="#000000">]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">else</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>username
			= cn</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			Exception, e:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">raise</FONT><FONT COLOR="#000000">
			AAUserRolesError, </FONT><FONT COLOR="#00aa00"><I>&quot;Parsing
			username from DN %s: %s&quot;</I></FONT><FONT COLOR="#000000"> %
			(dn,e)</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">return</FONT><FONT COLOR="#000000">
			[</FONT><FONT COLOR="#00aa00"><I>'Public'</I></FONT><FONT COLOR="#000000">,
			</FONT><FONT COLOR="#00aa00"><I>'Researcher'</I></FONT><FONT COLOR="#000000">]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">class</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>UserRoles</B></FONT><FONT COLOR="#000000">(AAUserRoles):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#00aa00"><I>&quot;&quot;&quot;User
			Roles class dynamically imported for Attribute Authority</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>-
			see the Attribute Authority Properties file to make the correct</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">   
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>settings&quot;&quot;&quot;</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">def</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>__init__</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">,
			propertiesFilePath=</FONT><FONT COLOR="#0000ff">None</FONT><FONT COLOR="#000000">):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">if</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#0000ff">not</FONT><FONT COLOR="#000000">
			propertiesFilePath:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">raise</FONT><FONT COLOR="#000000">
			AAUserRolesError, </FONT><FONT COLOR="#00aa00"><I>&quot;No user
			roles property file set&quot;</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#000000">	
			   </FONT><FONT COLOR="#c0c0c0"># Retrieve database connection and
			query settings from config file</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>configParser
			= SafeConfigParser()</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>configParser.read(propertiesFilePath)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">.__conxnStr
			= configParser.get(</FONT><FONT COLOR="#00aa00"><I>'Oracle'</I></FONT><FONT COLOR="#000000">,
			</FONT><FONT COLOR="#00aa00"><I>'connection'</I></FONT><FONT COLOR="#000000">)</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			The Oracle connection could be made HERE to make getRoles method</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			more efficient but then AA would hog an Oracle connection as long
			as</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			it is running.  There may be away to avoid this using a connection</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#000000">	
			   </FONT><FONT COLOR="#c0c0c0"># pool</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">.__query
			=  configParser.get(</FONT><FONT COLOR="#00aa00"><I>'Oracle'</I></FONT><FONT COLOR="#000000">,
			</FONT><FONT COLOR="#00aa00"><I>'query'</I></FONT><FONT COLOR="#000000">)</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			   </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">def</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#000000"><B>getRoles</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000"><I>self</I></FONT><FONT COLOR="#000000">,
			dn):</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#00aa00"><I>'''Roles
			interface for BODC database'''</I></FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Parse username from DN string</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			TODO: this may be e-mail address for BODC?</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>cn
			= X500DN(dn)[</FONT><FONT COLOR="#00aa00"><I>'CN'</I></FONT><FONT COLOR="#000000">]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">if</FONT><FONT COLOR="#000000">
			len(cn) == </FONT><FONT COLOR="#800000">2</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Proxy cert has two common names set - assume extra common </FONT></FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			name will be 'prixy' or a number</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>username=[n
			</FONT><FONT COLOR="#0000ff">for</FONT><FONT COLOR="#000000"> n </FONT><FONT COLOR="#0000ff">in</FONT><FONT COLOR="#000000">
			cn </FONT><FONT COLOR="#0000ff">if</FONT><FONT COLOR="#000000">
			n!=</FONT><FONT COLOR="#00aa00"><I>&quot;proxy&quot;</I></FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#0000ff">and</FONT><FONT COLOR="#000000"> </FONT><FONT COLOR="#0000ff">not</FONT><FONT COLOR="#000000">
			n.isdigit()][</FONT><FONT COLOR="#800000">0</FONT><FONT COLOR="#000000">]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">else</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>username
			= cn</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			Exception, e:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">raise</FONT><FONT COLOR="#000000">
			AAUserRolesError, </FONT><FONT COLOR="#00aa00"><I>&quot;Parsing
			username from DN %s: %s&quot;</I></FONT><FONT COLOR="#000000"> %
			(dn,e)</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><BR>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			It may be possible to use a connection pool and move this</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			connect call to __init__ see:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			http://www.python.net/crew/atuining/cx_Oracle/html/module.html</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>con
			= cx_Oracle.connect(<I>self</I>.__conxnStr)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>cursor
			= con.cursor()</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			Exception, e:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">raise</FONT><FONT COLOR="#000000">
			AAUserRolesError, </FONT><FONT COLOR="#00aa00"><I>&quot;Error
			connecting to Oracle database: &quot;</I></FONT><FONT COLOR="#000000">
			+\</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">        <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>			
			               str(e)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">        
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Substitute the username into the query - the query is expected to </FONT></FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			have a &quot;%s&quot; to allow this</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Convert username to string type explicitly as the execute method </FONT></FONT></FONT>
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			doesn't like unicode type</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>query
			= <I>self</I>.__query % str(username)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>cursor.execute(query)</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			    <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>result
			= cursor.fetchall()</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			Exception, e:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			               </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">raise</FONT><FONT COLOR="#000000">
			AAUserRolesError, </FONT><FONT COLOR="#00aa00"><I>&quot;Error
			executing query: &quot;</I></FONT><FONT COLOR="#000000"> + str(e)</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">finally</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>	cursor.close()</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">       
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>	con.close()</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">        
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Result is a list of tuples.  The first element of each tuple is a</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			role name -&gt; Convert into a simple list of role names</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">try</FONT><FONT COLOR="#000000">:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>roleNames
			= [role[</FONT><FONT COLOR="#800000">0</FONT><FONT COLOR="#000000">]
			</FONT><FONT COLOR="#0000ff">for</FONT><FONT COLOR="#000000"> role
			</FONT><FONT COLOR="#0000ff">in</FONT><FONT COLOR="#000000">
			result]</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff">except</FONT><FONT COLOR="#000000">
			TypeError:</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			           </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#c0c0c0">#
			Catch non-iterable error with result var</FONT></FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">           
			<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2>roleNames
			= []</FONT></FONT></P>
			<P STYLE="margin-bottom: 0cm; background: transparent">        
			</P>
			<P STYLE="margin-bottom: 0cm; background: transparent"><FONT COLOR="#000000">
			       </FONT><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><FONT SIZE=2><FONT COLOR="#0000ff"><FONT FACE="Monospace">return</FONT></FONT><FONT COLOR="#000000"><FONT FACE="Monospace">
			roleNames</FONT></FONT></FONT></FONT></P>
			<P STYLE="background: transparent"><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Note:</P>
<UL>
	<LI><P CLASS="western" ALIGN=JUSTIFY>It uses the Python library
	cx_<FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">Oracle</SPAN></FONT>
	to connect to an Oracle database.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ElementTree</SPAN></FONT>
	Python library is used to parse an XML properties file.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">ndg.security.common.X509</SPAN></FONT>
	security python library is used to parse the user Distinguished Name
	passed into <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">getRoles</SPAN></FONT>
	and <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">userIsRegistered</SPAN></FONT>
	methods.</P>
	<LI><P CLASS="western" ALIGN=JUSTIFY>Database connection and query
	settings are taken from a config file:</P>
</UL>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0 STYLE="page-break-before: auto">
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#
			BODC Attribute Authority - Oracle interface settings</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#
			P J Kershaw 09/08/07</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Monospace"><FONT SIZE=2>[Oracle]</FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#
			Database connection string</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Monospace"><FONT SIZE=2><FONT COLOR="#000000">connection
			= </FONT><FONT COLOR="#2a00ff">user/password@dsn</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT COLOR="#3f7f5f"><FONT FACE="Monospace"><FONT SIZE=2>#
			Query string &quot;%%s&quot; will be substituted by the username
			specified by the code</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="margin-bottom: 0cm; background: transparent">
			<FONT FACE="Monospace"><FONT SIZE=2><FONT COLOR="#000000">query =
			</FONT><FONT COLOR="#2a00ff">select</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">something</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">from</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">atable</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">where</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">username</FONT><FONT COLOR="#000000">
			</FONT><FONT COLOR="#2a00ff">=</FONT><FONT COLOR="#000000"> </FONT><FONT COLOR="#2a00ff">'%%s'</FONT></FONT></FONT></P>
			<P CLASS="western" ALIGN=LEFT STYLE="background: transparent"><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=LEFT><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<H2 CLASS="western"><A NAME="5.6. Troubleshooting|outline"></A>5.6
Troubleshooting</H2>
<H3 CLASS="western"><A NAME="5.6.1. M2Crypto |outline"></A>5.6.1
M2Crypto 
</H3>
<H4 CLASS="western">5.6.1.1 SWIG</H4>
<P CLASS="western" ALIGN=JUSTIFY>M2Crypto uses SWIG to bind C OpenSSL
library code to the Python interface.   If SWIG is not present on
your system, the M2Crypto build will fail with an error such as:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">unable
			to execute swig: No such file or directory<BR>error: Setup script
			exited with error: command 'swig' failed with exit status 1</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>Alternatively, compilation
errors with swig <FONT FACE="Lucida Console, DejaVu Sans Mono, monospace"><SPAN LANG="en-GB">.i</SPAN></FONT>
files in the M2Crypto tar bundle can be caused by use of an earlier
version of swig.  This has been seen with the default swig on Redhat
EL4.  This comes with swig version 1.1.  To check the SWIG version
number type:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$ swig
			-version</FONT></P>
			<P><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>Some version will build OK but
then cause runtime errors e.g.</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">File
			&quot;.../M2Crypto/SSL/Context.py&quot;, line 43, in __init__
			map()[long(self.ctx)] = self ValueError: invalid literal for
			long(): _480e1008_p_SSL_CTX </FONT>
			</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>To fix update to a version &gt;=
1.3.24 and re-run the installation script but also make sure to read
the next section.  SWIG is available from <FONT COLOR="#0000ff"><U><A HREF="http://www.swig.org/">http://www.swig.org/</A></U></FONT>
or alternatively may be installed as an rpm or with apt-get for a
Debian package.</P>
<H4 CLASS="western">5.6.1.2 SWIG and Py_ssize_t build error</H4>
<P CLASS="western" ALIGN=JUSTIFY>The combination SWIG version
1.3.30rc1 and Python &lt; 2.5 can cause a build error:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">_lib.h:5:
			error: redefinition of typedef 'Py_ssize_t'</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Avoid this version of SWIG.</P>
<P CLASS="western" ALIGN=JUSTIFY>See:
<A HREF="http://chandlerproject.org/Projects/MeTooCrypto#FAQ">http://chandlerproject.org/Projects/MeTooCrypto#FAQ</A>
for reference and up to date details of any other M2Crypto related
issues.</P>
<H4 CLASS="western">5.6.1.3 OpenSSL Header files Missing</H4>
<P CLASS="western" ALIGN=JUSTIFY>M2Crypto requires OpenSSL libraries
and header files to link with when being built.  On some systems, the
openssl executable may be present but not the required header files
or libraries.  You may see an error like this:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">SWIG/_m2crypto.i:23:
			Error: Unable to find 'openssl/opensslv.h'<BR>SWIG/_ec.i:7: Error:
			Unable to find 'openssl/opensslconf.h'<BR>error: Setup script
			exited with error: command 'swig' failed with exit status 1</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western">Depending on your system, install the
<FONT SIZE=2><SPAN STYLE="font-weight: medium">openssl-devel RPM or
</SPAN></FONT>libssl-dev Debian package or re-install OpenSSL from
source (<A HREF="http://www.openssl.org/">http://www.openssl.org</A>)</P>
<H3 CLASS="western"><A NAME="5.6.2. PyXML|outline"></A>5.6.2 PyXML</H3>
<P CLASS="western" ALIGN=JUSTIFY>error: Could not find suitable
distribution for Requirement.parse('PyXML&gt;=0.8.3')</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			easy_install –f
			<FONT COLOR="#0000ff"><U><A HREF="http://sourceforge.net/project/showfiles.php?group_id=6473">http://sourceforge.net/project/showfiles.php?group_id=6473</A></U></FONT>
			PyXML</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR>or –f option with
ndg-security-install.py</P>
<H3 CLASS="western"><A NAME="5.6.3. 4Suite-XML Build error|outline"></A>
5.6.3 4Suite-XML Build error</H3>
<P CLASS="western" ALIGN=JUSTIFY>Ft/Xml/src/expat/lib/xmlparse.c:89:2:
#error memmove does not exist on this platform, nor is a substitute
available</P>
<P CLASS="western" ALIGN=JUSTIFY>4Suite-XML 1.0.2</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<OL START=3>
				<P CLASS="western" ALIGN=LEFT>$ cat /proc/version<BR>Linux
				version 2.4.21-32.0.1.ELsmp (bhcompile@bugs.build.redhat.com)
				(gcc version 20030502 (Red Hat Linux 3.2.3-52)) #1 SMP Tue May 17
				17:52:23 EDT 2005</P>
			</OL>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$
			uname –a </FONT>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">Linux
			glue.badc.rl.ac.uk 2.4.21-32.0.1.ELsmp #1 SMP Tue May 17 17:52:23
			EDT 2005 i686 i686 i386 GNU/Linux</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY>Solution:</P>
<TABLE WIDTH=626 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0>
	<COL WIDTH=610>
	<TR>
		<TD WIDTH=610 VALIGN=TOP BGCOLOR="#e0e0e0">
			<P STYLE="margin-bottom: 0cm"><BR>
			</P>
			<P><FONT FACE="Lucida Console, DejaVu Sans Mono, monospace">$ echo
			-e &quot;[build_ext]\ndefine=HAVE_MMEMOVE&quot; &gt;
			~/.pydistutils.cfg<BR>$ easy_install 4Suite-XML</FONT></P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
<P CLASS="western" ALIGN=JUSTIFY><BR><BR>
</P>
</BODY>
</HTML>