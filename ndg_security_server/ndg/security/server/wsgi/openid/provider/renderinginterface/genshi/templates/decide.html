<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:py="http://genshi.edgewall.org/"
	xmlns:xi="http://www.w3.org/2001/XInclude">        
    <head>
    	<xi:include href="base.html"/>
	    <replace py:replace="pagehead()"/>
    </head>
    <body>
        <div id="main">
            <div py:replace="header()"/>
            <div id="decideFormContent">  
            	<form method="POST" action="${c.urls['url_allow']}">
            		<table>
            			<input type="hidden" name="identity" value="$c.identityURI" />
            			<tr>
            				<td>
    		        			The website <b>$c.oidRequest.trust_root</b> has requested 
    		        			your OpenID for sign in:
            				</td>
            			</tr>
            			<tr>
    	                 	<td>
    	                 		<div id="identityUriBox">$c.identityURI</div>
    	                 	</td>
    	                </tr>
            			<tr py:if="len(axRequestedAttr) > 0">
            			    <td>
    		        			This site has also requested some additional information:
            			         <table id="opAXRequestedAttributes">
        			                <tr>
        			                    <th>Item</th>
        			                    <th>Value</th>
        			                    <th>Return Item to Requesting Site?</th>
        			                </tr>
									<tr py:for="i in axRequestedAttr.values()">
									    <td>${i.alias or i.type_uri}</td>
									    <?python
									       defaultVal = "<information not available from this site>"
									       attrVal = axFetchResponse.getSingle(i.type_uri, default=defaultVal)
									       
									       # Disable checkbox if attribute is required and not optional
									       nameAttr = 'ax.%s' % i.alias
									       if i.required:
									       	   inputAttr = {'disabled': 'disabled'}
									       else:
									       	   inputAttr = {'id': i.alias, 'name': nameAttr, 'value': i.type_uri}
									       	
									       if attrVal == defaultVal:
									           inputAttr.update({'disabled': 'disabled'})
									       else:
									           inputAttr.update({'checked': "checked"})
									    ?>
										<td>${attrVal}</td>
										<!-- hidden input is required to force the setting of disabled checkbox values -->
									    <td><input type="checkbox"  py:attrs="inputAttr"/>
									        <input py:if="i.required" type="hidden" value="${i.type_uri}" name="$nameAttr"/></td>
									</tr> 
							    </table>
            			    </td>
            			</tr>
            			<tr>
            				<td>        					
    	        				Would you like to pass your OpenID credential
    	        				information back to $c.oidRequest.trust_root and 
    	        				return to this site?  
            				</td>
            			</tr>
            			<tr>
            				<td align="right">
            					<input type="submit" name="$c.APPROVE_RP_SUBMIT" value="Yes" />
            					<input type="submit" name="$c.REJECT_RP_SUBMIT" value="No" />
            				</td>
            			</tr>
            			<tr>
            				<td align="right">
            					<div py:if="c.oidRequest.trust_root not in c.session.get('approved', {})">
    	        					<input type="checkbox" id="remember" name="remember" value="Yes"/>
    	        					<label for="remember">Remember this decision for session duration</label>
            					</div>
            				</td>
            			</tr>
            		</table>
            	</form>
            </div>
            <div py:replace="footer()"/>
        </div>
    </body>
</html>