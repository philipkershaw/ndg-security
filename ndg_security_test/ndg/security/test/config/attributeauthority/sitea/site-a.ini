#
# PasteDeploy ini file for Attribute Authority Unit tests Site A Server
# 
# NERC Data Grid Project
# 
# P J Kershaw 12/09/08
# 
# Copyright (C) 2009 Science and Technology Facilities Council
# 
# BSD - See LICENCE file for details

[DEFAULT]
attributeAuthorityEnvironKeyName = attribute-authority
attributeQueryInterfaceEnvironKeyName = attributeQueryInterface

[server:main]
use = egg:Paste#http
host = 0.0.0.0
port = 5000

[app:mainApp]
paste.app_factory = ndg.security.test.config.attributeauthority.sitea.sitea_attributeauthority:app_factory

# Chain of SOAP Middleware filters - Nb. WS-Security filters apply to the SOAP
# Binding filter only.
[pipeline:main]
pipeline = AttributeAuthorityFilter 
		   AttributeAuthoritySamlSoapBindingFilter
		   mainApp


[filter:AttributeAuthorityFilter]
paste.filter_app_factory = ndg.security.server.wsgi.attributeauthority:AttributeAuthorityMiddleware.filter_app_factory
prefix = attributeAuthority.

# Key name by which the WSDL SOAP based interface may reference this
# service
attributeAuthority.environKeyName = %(attributeAuthorityEnvironKeyName)s

# Key name for the SAML SOAP binding based interface to reference this
# service's attribute query method
attributeAuthority.environKeyNameAttributeQueryInterface: %(attributeQueryInterfaceEnvironKeyName)s

# Attribute Authority settings...

# Lifetime is measured in seconds
attributeAuthority.assertionLifetime: 28800 

# Settings for custom AttributeInterface derived class to get user roles for given 
# user ID
attributeAuthority.attributeInterface.modFilePath: %(here)s
attributeAuthority.attributeInterface.className: sitea_attributeinterface.TestUserRoles

# SAML SOAP Binding to the Attribute Authority
[filter:AttributeAuthoritySamlSoapBindingFilter]
paste.filter_app_factory = ndg.saml.saml2.binding.soap.server.wsgi.queryinterface:SOAPQueryInterfaceMiddleware.filter_app_factory
prefix = saml.soapbinding.

saml.soapbinding.deserialise = ndg.saml.xml.etree:AttributeQueryElementTree.fromXML

# Specialisation to incorporate ESG Group/Role type
saml.soapbinding.serialise = ndg.security.common.saml_utils.esgf.xml.etree:ESGFResponseElementTree.toXML

saml.soapbinding.mountPath = /AttributeAuthority
saml.soapbinding.queryInterfaceKeyName = %(attributeQueryInterfaceEnvironKeyName)s

# Clock skew for SAML Attribute Queries - allow clockSkew number of seconds
# tolerance for query issueInstant parameter. Set here to 3 minutes
saml.soapbinding.clockSkewTolerance: 180.0

saml.soapbinding.issuerName: /O=Site A/CN=Attribute Authority

# Logging configuration
[loggers]
keys = root, ndg

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = INFO
handlers = console

[logger_ndg]
level = DEBUG
handlers = 
qualname = ndg

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(asctime)s.%(msecs)03d %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %Y/%m/%d %H:%M:%S
